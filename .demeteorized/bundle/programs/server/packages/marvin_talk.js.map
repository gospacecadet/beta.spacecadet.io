{"version":3,"sources":["meteor://ðŸ’»app/messages.js","meteor://ðŸ’»app/threads.js","meteor://ðŸ’»app/talk.js","meteor://ðŸ’»app/talk-server.js"],"names":[],"mappings":"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","file":"/packages/marvin_talk.js","sourcesContent":["Messages = new Mongo.Collection(\"TalkMessages\", {\n  transform: function (doc) { return new Message(doc); }\n});\n\nvar Message = function(doc) {\n  _.extend(this, doc)\n}\n\n_.extend(Message.prototype, {\n  isSender: function() {\n    return this.senderId === Meteor.userId()\n  },\n  yourName: function() {\n    if(this.senderId === Meteor.userId())\n      return \"You\"\n  },\n  otherName: function() {\n    var user = Meteor.users.findOne(this.senderId)\n\n    if(user && user.profile)\n      return user.profile.firstName + \" \" + user.profile.lastName\n  },\n  isRecipient: function() {\n    return this.recipientId === Meteor.userId()\n  },\n  isText: function() {\n    return !!this.body\n  },\n  isAttachment: function() {\n    return !!this.attachmentUrl\n  }\n})\n","Threads = new Mongo.Collection(\"TalkThreads\", {\n  transform: function (doc) { return new Thread(doc); }\n});\n\nvar Thread = function(doc) {\n  _.extend(this, doc)\n}\n\n_.extend(Thread.prototype, {\n  recipientId: function() {\n    return this.user1Id === Meteor.userId() ? this.user2Id : this.user1Id\n  },\n  messages: function() {\n    return Messages.find({threadId: this._id})\n  },\n  recipientName: function() {\n    var recipientId = this.recipientId()\n\n    if(recipientId) {\n      var recipient = Meteor.users.findOne(recipientId)\n      if(recipient && recipient.profile)\n        return recipient.profile.firstName + \" \" + recipient.profile.lastName\n    }\n  }\n})\n","Talk = {\n  Messages: Messages,\n  Threads: Threads,\n  thread: function(recipientId) {\n    var thread = Threads.findOne({$or: [\n      {user1Id: recipientId},\n      {user2Id: recipientId}\n    ]})\n\n    if(thread)\n      return thread\n\n    var threadId = Meteor.call(\"talk/create-thread\", recipientId);\n  },\n  threads: function() {\n    var allThreads = Talk.Threads.find().fetch()\n\n    return _.filter(allThreads, function(thread) {\n      return thread.messages().count() > 0\n    })\n  },\n  send: function(options, callback) {\n    console.log('send');\n    Meteor.call(\"talk/send\", options, callback);\n  },\n}\n","Meteor.methods({\n  'talk/send': function(options) {\n    console.log('talk/send');\n    if(!Meteor.userId())\n      throw new Meteor.Error('talk-not-logged-in', \"Cannot send messages when not logged in.\")\n\n    check(options, {\n      recipientId: String,\n      body: Match.Optional(String),\n      attachmentUrl: Match.Optional(String),\n      attachmentName: Match.Optional(String),\n    })\n\n    var message = {\n      recipientId: options.recipientId,\n      senderId: Meteor.userId()\n    }\n\n    if(options.attachmentName || options.attachmentUrl) {\n      if(!options.attachmentName || !options.attachmentUrl) {\n        throw new Meteor.Error('talk-incomplete-attachment', \"Attachment name and URL must both be provided or must both be undefined.\")\n      } else {\n        message.attachmentName = options.attachmentName\n        message.attachmentUrl = options.attachmentUrl\n      }\n    }\n\n    if(!Meteor.users.findOne(options.recipientId))\n      throw new Meteor.Error('talk-invalid-recipient', \"The user you are trying to send to does not exist.\")\n\n    if(options.body)\n      message.body = options.body\n\n    message.createdAt = new Date()\n\n    var thread = Threads.findOne({$or: [\n      {$and: [\n        {user1Id: Meteor.userId()},\n        {user2Id: message.recipientId}\n      ]},\n      {$and: [\n        {user2Id: Meteor.userId()},\n        {user1Id: message.recipientId}\n      ]}\n    ]})\n\n    if(!thread) {\n      thread = Threads.insert({\n        user1Id: Meteor.userId(),\n        user2Id: message.recipientId\n      })\n    }\n\n    message.threadId = thread._id\n    return Messages.insert(message)\n  },\n  'talk/create-thread': function(recipientId) {\n    check(recipientId, String);\n\n    if(Meteor.userId())\n      return Threads.insert({user1Id: Meteor.userId(), user2Id: recipientId})\n  }\n});\n\nMeteor.publish(\"talk/messages\", function(threadId) {\n  console.log(threadId);\n  check(threadId, String);\n\n  var thread = Threads.findOne({$or: [\n    {user1Id: this.userId},\n    {user2Id: this.userId}\n  ]})\n\n  if(thread)\n    return Messages.find({threadId: threadId}, {sort: {createdAt: -1}})\n});\n\nMeteor.publish(\"talk/all-messages\", function() {\n  return Messages.find({$or: [\n    {senderId: this.userId},\n    {recipientId: this.userId}\n  ]}, {sort: {createdAt: -1}})\n});\n\nMeteor.publish(\"talk/threads\", function() {\n  return Threads.find({$or: [\n    {user1Id: this.userId},\n    {user2Id: this.userId}\n  ]})\n});\n"]}
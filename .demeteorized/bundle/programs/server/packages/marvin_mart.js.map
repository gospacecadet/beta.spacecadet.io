{"version":3,"sources":["meteor://ðŸ’»app/lib/mart.js","meteor://ðŸ’»app/lib/errors.js","meteor://ðŸ’»app/lib/accounts/accounts.js","meteor://ðŸ’»app/lib/security-helpers.js","meteor://ðŸ’»app/lib/storefronts/storefronts.js","meteor://ðŸ’»app/lib/images/images.js","meteor://ðŸ’»app/lib/gateways/gateways.js","meteor://ðŸ’»app/lib/payment_methods/cards/cards.js","meteor://ðŸ’»app/lib/gateways/stripe/stripe.js","meteor://ðŸ’»app/lib/gateways/test/test.js","meteor://ðŸ’»app/lib/products/products.js","meteor://ðŸ’»app/lib/prices/prices.js","meteor://ðŸ’»app/lib/line_items/line_items.js","meteor://ðŸ’»app/lib/bank-accounts/bank-accounts.js","meteor://ðŸ’»app/lib/carts/carts.js","meteor://ðŸ’»app/lib/storefronts/server/storefronts-publications.js","meteor://ðŸ’»app/lib/storefronts/server/storefronts-security.js","meteor://ðŸ’»app/lib/accounts/accounts-server.js","meteor://ðŸ’»app/lib/accounts/accounts-publications.js","meteor://ðŸ’»app/lib/payment_methods/cards/cards_server.js","meteor://ðŸ’»app/lib/products/products-publications.js","meteor://ðŸ’»app/lib/products/products-security.js","meteor://ðŸ’»app/lib/prices/prices-security.js","meteor://ðŸ’»app/lib/gateways/gateways_server.js","meteor://ðŸ’»app/lib/gateways/stripe/stripe_server.js","meteor://ðŸ’»app/lib/line_items/line_items_server.js","meteor://ðŸ’»app/lib/carts/carts-publications.js","meteor://ðŸ’»app/lib/carts/carts-security.js","meteor://ðŸ’»app/lib/carts/carts-machina.js","meteor://ðŸ’»app/lib/bank-accounts/bank-accounts-server.js","meteor://ðŸ’»app/lib/gateways/stripe/stripe-customers.js","meteor://ðŸ’»app/lib/gateways/stripe/stripe-managed-accounts.js","meteor://ðŸ’»app/lib/carts/carts-methods.js","meteor://ðŸ’»app/lib/images/images-publications.js","meteor://ðŸ’»app/lib/images/images-security.js","meteor://ðŸ’»app/lib/storefronts/server/storefronts-methods.js","meteor://ðŸ’»app/lib/products/products-methods.js","meteor://ðŸ’»app/lib/prices/prices-publications.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAI,GAAG;AACL,iBAAe,EAAE,UAAU,CAAC,MAAM,CAAC,QAAQ,UAAO,CAAC,eAAe,CAAC;AACnE,yBAAuB,EAAE,UAAU,CAAC,MAAM,CAAC,QAAQ,UAAO,CAAC,uBAAuB,CAAC;AACnF,wBAAsB,EAAE,UAAU,CAAC,MAAM,CAAC,QAAQ,UAAO,CAAC,sBAAsB,CAAC;AACjF,0BAAwB,EAAE,UAAU,CAAC,MAAM,CAAC,QAAQ,UAAO,CAAC,wBAAwB,CAAC;AACrF,SAAO,EAAE,UAAU,CAAC,MAAM,CAAC,QAAQ,UAAO,CAAC,OAAO,CAAC;AACnD,mBAAiB,EAAE,MAAM,CAAC,QAAQ,UAAO,CAAC,iBAAiB;CAC5D;;AAED,IAAG,MAAM,CAAC,QAAQ,EAAC;AACjB,GAAC,CAAC,MAAM,CAAC,IAAI,EAAE;AACb,qBAAiB,EAAE,MAAM,CAAC,QAAQ,CAAC,iBAAiB;GACrD,CAAC;CACH,sH;;;;;;;;;;;;;;;;;;ACbD,IAAI,CAAC,MAAM,GAAG;AACZ,cAAY,EAAE,mBAAmB;AACjC,gBAAc,EAAE,qBAAqB;CACtC,sH;;;;;;;;;;;;;;;;;;ACHD,CAAC,CAAC,MAAM,CAAC,IAAI,EAAE;AACb,OAAK,EAAE;AACL,UAAM,EAAE;AACN,aAAO,EAAE,2BAA2B;AACpC,cAAQ,EAAE,4BAA4B;AACtC,WAAK,EAAE,yBAAyB;AAChC,SAAG,EAAE,uBAAuB;KAC7B;AACD,UAAM,EAAE;AACN,YAAM,EAAE,0BAA0B;KACnC;GACF;AACD,SAAO,EAAE,YAAW;AAClB,WAAO,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC;GACtC;AACD,OAAK,EAAE,YAAW;AAChB,WAAO,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC;GACpC;AACD,YAAU,EAAE,YAAW;AACrB,WAAO,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC;GACzC;AACD,kBAAgB,EAAE,YAAW;AAC3B,WAAO,IAAI,CAAC,UAAU,EAAE,IAAI,IAAI,CAAC,KAAK,EAAE,IAAI,IAAI,CAAC,OAAO,EAAE;GAC3D;AACD,UAAQ,EAAE,UAAS,MAAM,EAAE;AACzB,WAAO,KAAK,CAAC,YAAY,CAAC,MAAM,EAC9B,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,EACzB,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC;GAC5B;AACD,QAAM,EAAE,UAAS,MAAM,EAAE;AACvB,WAAO,KAAK,CAAC,YAAY,CAAC,MAAM,EAC9B,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC,EACvB,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC;GAC5B;AACD,aAAW,EAAE,UAAS,MAAM,EAAE;AAC5B,WAAO,KAAK,CAAC,YAAY,CAAC,MAAM,EAC9B,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,QAAQ,CAAC,EAC5B,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC;GAC5B;AACD,YAAU,EAAE,UAAS,MAAM,EAAE;AAC3B,WAAO,KAAK,CAAC,YAAY,CAAC,MAAM,EAC9B,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,OAAO,CAAC,EAC3B,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC;GAC5B;AACD,UAAQ,EAAE;;AAER,cAAU,EAAE,UAAS,OAAO,EAAE,QAAQ,EAAE;AACtC,UAAG,CAAC,MAAM,CAAC,MAAM,EAAE,EAAE;AACnB,gBAAQ,CAAC,UAAU,CAAC,OAAO,EAAE,UAAS,KAAK,EAAE;AAC3C,cAAG,KAAK,EACN,OAAO,QAAQ,CAAC,KAAK,CAAC;;AAExB,gBAAM,CAAC,IAAI,CAAC,0BAA0B,EAAE,OAAO,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC;SAClE,CAAC;OACH,MAAM;AACL,gBAAQ,CAAC,IAAI,MAAM,CAAC,KAAK,CAAC,cAAc,EAAE,mDAAmD,CAAC,CAAC;OAChG;KACF;AACD,gBAAY,EAAE,IAAI,YAAY,CAAC;AAC7B,WAAK,EAAE;AACL,YAAI,EAAE,MAAM;OACb;AACD,cAAQ,EAAE;AACR,YAAI,EAAE,MAAM;OACb;AACD,mBAAa,EAAE;AACb,YAAI,EAAE,OAAO;OACd;KACF,CAAC;;GAEH;CACF,CAAC,qH;;;;;;;;;;;;;;;;;;ACvEF,QAAQ,CAAC,YAAY,CAAC,SAAS,EAAE;AAC/B,OAAK,EAAE,EAAE;AACT,MAAI,EAAE,UAAU,IAAI,EAAE,KAAK,EAAE,MAAM,EAAE,GAAG,EAAE;AACxC,WAAO,CAAC,MAAM,IACZ,CAAC,KAAK,CAAC,YAAY,CAAC,MAAM,EAAE,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC;GAC/D;CACF,CAAC,CAAC,oH;;;;;;;;;;;;;;;;;;ACNH,IAAI,CAAC,WAAW,GAAG,IAAI,KAAK,CAAC,UAAU,CAAC,iBAAiB,EAAC;AACxD,WAAS,EAAE,UAAS,GAAG,EAAE;AAAC,WAAO,IAAI,UAAU,CAAC,GAAG,CAAC;GAAC;CACtD,CAAC,CAAC;;AAEH,IAAI,UAAU,GAAG,UAAS,GAAG,EAAE;AAC7B,GAAC,CAAC,MAAM,CAAC,IAAI,EAAE,GAAG,CAAC;CACpB;;AAED,CAAC,CAAC,MAAM,CAAC,UAAU,CAAC,SAAS,EAAE;AAC7B,UAAQ,EAAE,YAAW;AACnB,WAAO,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAC,YAAY,EAAE,IAAI,CAAC,GAAG,EAAC,CAAC;GACpD;CACF,CAAC;AACF,IAAI,CAAC,WAAW,CAAC,YAAY,CAAC,IAAI,YAAY,CAAC;AAC7C,MAAI,EAAE;AACJ,QAAI,EAAE,MAAM;AACZ,SAAK,EAAE,MAAM;AACb,OAAG,EAAE,EAAE;GACR;AACD,aAAW,EAAE;AACX,QAAI,EAAE,MAAM;AACZ,SAAK,EAAE,aAAa;AACpB,YAAQ,EAAE,IAAI;AACd,OAAG,EAAE,IAAI;GACV;AACD,aAAW,EAAE;AACX,QAAI,EAAE,OAAO;AACb,SAAK,EAAE,wBAAwB;AAC/B,aAAS,EAAE,YAAW;;AAEpB,UAAI,CAAC,KAAK,EAAE;AACZ,UAAG,IAAI,CAAC,QAAQ,EAAE;AAChB,eAAO,KAAK;OACb;KACF;GACF;AACD,WAAS,EAAE;AACT,QAAI,EAAE,OAAO;AACb,aAAS,EAAE,YAAW;;AAEpB,UAAI,CAAC,KAAK,EAAE;AACZ,UAAG,IAAI,CAAC,QAAQ,EAAE;AAChB,eAAO,KAAK;OACb;KACF;GACF;AACD,QAAM,EAAE;AACN,QAAI,EAAE,MAAM;;;AAGZ,aAAS,EAAE,YAAW;AACpB,UAAG,IAAI,CAAC,QAAQ,EAAE;AAChB,YAAG,KAAK,CAAC,YAAY,CACnB,IAAI,CAAC,MAAM,EACX,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,GAAG,EAAE,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,EAChD,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,EAAE;AACzB,iBAAM;SACT,MAAM,IAAG,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE;AACvC,iBAAO,IAAI,CAAC,MAAM;SACnB;OACF;AACD,UAAI,CAAC,KAAK,EAAE;KACb;AACD,cAAU,EAAE,IAAI;GACjB;AACD,OAAK,EAAE;AACL,QAAI,EAAE,MAAM;AACZ,YAAQ,EAAE,IAAI;AACd,aAAS,EAAE,YAAW;AACpB,UAAG,IAAI,CAAC,QAAQ,IAAI,KAAK,CAAC,YAAY,CACpC,IAAI,CAAC,MAAM,EACX,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC,EACvB,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,EAAE;AACzB,eAAO,IAAI,CAAC,MAAM;OACrB,MAAM,IAAG,KAAK,CAAC,YAAY,CAC1B,IAAI,CAAC,MAAM,EACX,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,EACzB,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,EAAE;AACzB,eAAO,IAAI,CAAC,KAAK,IAAI,IAAI,CAAC,MAAM;OACnC;;AAED,UAAI,CAAC,KAAK,EAAE;KACb;GACF;AACD,SAAO,EAAE;AACP,QAAI,EAAE,MAAM;GACb;AACD,UAAQ,EAAE;AACR,QAAI,EAAE,MAAM;AACZ,YAAQ,EAAE,IAAI;GACf;AACD,MAAI,EAAE;AACJ,QAAI,EAAE,MAAM;GACb;AACD,OAAK,EAAE;AACL,QAAI,EAAE,MAAM;GACb;AACD,KAAG,EAAE;AACH,QAAI,EAAE,MAAM;GACb;AACD,WAAS,EAAE;AACT,QAAI,EAAE,IAAI;AACV,aAAS,EAAE,YAAW;AACpB,UAAG,IAAI,CAAC,QAAQ,EAAE;AAChB,eAAO,IAAI,IAAI,EAAE;OAClB;;AAED,UAAI,CAAC,KAAK,EAAE;KACb;GACF;CACF,CAAC,CAAC,oH;;;;;;;;;;;;;;;;;;AC9GH,IAAI,CAAC,MAAM,GAAG,IAAI,KAAK,CAAC,UAAU,CAAC,YAAY,CAAC,CAAC;;AAEjD,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,IAAI,YAAY,CAAC;AACxC,UAAQ,EAAE;AACR,QAAI,EAAE,MAAM;AACZ,cAAU,EAAE,IAAI;GACjB;AACD,kBAAgB,EAAE;AAChB,QAAI,EAAE,MAAM;AACZ,cAAU,EAAE,IAAI;AAChB,iBAAa,EAAE,CAAC,aAAa,EAAE,UAAU,CAAC;GAC3C;AACD,aAAW,EAAE;AACX,QAAI,EAAE,MAAM;AACZ,cAAU,EAAE,IAAI;GACjB;AACD,cAAY,EAAE;AACZ,QAAI,EAAE,MAAM;AACZ,cAAU,EAAE,IAAI;GACjB;AACD,cAAY,EAAE;AACZ,QAAI,EAAE,MAAM;AACZ,cAAU,EAAE,IAAI;GACjB;AACD,OAAK,EAAE;AACL,QAAI,EAAE,MAAM;GACb;CACF,CAAC,CAAC,CAAC,mH;;;;;;;;;;;;;;;;;;AC3BJ,IAAI,CAAC,QAAQ,GAAG,IAAI,KAAK,CAAC,UAAU,CAAC,cAAc,CAAC,CAAC;AACrD,IAAI,CAAC,YAAY,GAAG,EAAE;;AAEtB,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,IAAI,YAAY,CAAC;AAC1C,aAAW,EAAE;AACX,QAAI,EAAE,MAAM;AACZ,iBAAa,EAAE,CAAC,MAAM,EAAE,QAAQ,CAAC;GAClC;AACD,cAAY,EAAE;AACZ,QAAI,EAAE,MAAM;GACb;AACD,aAAW,EAAE;AACX,QAAI,EAAE,MAAM;GACb;AACD,kBAAgB,EAAE;AAChB,QAAI,EAAE,OAAO;GACd;AACD,gBAAc,EAAE;AACd,QAAI,EAAE,OAAO;GACd;AACD,kBAAgB,EAAE;AAChB,QAAI,EAAE,OAAO;GACd;CACF,CAAC,CAAC,CAAC,mH;;;;;;;;;;;;;;;;;;ACvBJ,IAAI,CAAC,KAAK,GAAG,IAAI,KAAK,CAAC,UAAU,CAAC,WAAW,CAAC,CAAC;AAC/C,IAAI,CAAC,IAAI,GAAG;AACV,MAAI,EAAE,UAAS,MAAM,EAAE;AACrB,WAAO,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC;GAClC;AACD,SAAO,EAAE,UAAS,MAAM,EAAE;AACxB,WAAO,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,SAAS,CAAC;GAC1D;CACF;;AAED,IAAI,CAAC,KAAK,CAAC,YAAY,CAAC,IAAI,YAAY,CAAC;AACvC,QAAM,EAAE;AACN,QAAI,EAAE,MAAM;AACZ,aAAS,EAAE,YAAW;AACpB,aAAO,IAAI,CAAC,MAAM,CAAC;KACpB;AACD,cAAU,EAAE,IAAI;AAChB,YAAQ,EAAE,IAAI;GACf;AACD,SAAO,EAAE;AACP,QAAI,EAAE,MAAM;AACZ,cAAU,EAAE,IAAI;AAChB,YAAQ,EAAE,IAAI;GACf;AACD,SAAO,EAAE;AACP,QAAI,EAAE,MAAM;AACZ,cAAU,EAAE,IAAI;AAChB,iBAAa,EAAE,CAAC,MAAM,EAAE,QAAQ,CAAC;GAClC;AACD,cAAY,EAAE;AACZ,QAAI,EAAE,MAAM;AACZ,cAAU,EAAE,IAAI;GACjB;AACD,OAAK,EAAE;AACL,QAAI,EAAE,MAAM;AACZ,OAAG,EAAE,IAAI;AACT,OAAG,EAAE,IAAI;AACT,cAAU,EAAE,IAAI;GACjB;AACD,UAAQ,EAAE;AACR,QAAI,EAAE,MAAM;AACZ,OAAG,EAAE,CAAC;AACN,OAAG,EAAE,EAAE;AACP,cAAU,EAAE,IAAI;GACjB;AACD,SAAO,EAAE;AACP,QAAI,EAAE,MAAM;AACZ,OAAG,EAAE,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE;AAC7B,OAAG,EAAE,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE,GAAG,GAAG;AACnC,cAAU,EAAE,IAAI;GACjB;AACD,YAAU,EAAE;AACV,QAAI,EAAE,MAAM;AACZ,cAAU,EAAE,IAAI;AAChB,OAAG,EAAE,GAAG;GACT;AACD,OAAK,EAAE;AACL,QAAI,EAAE,MAAM;AACZ,cAAU,EAAE,IAAI;AAChB,iBAAa,EAAE,CAAC,MAAM,EAAE,YAAY,CAAC;GACtC;CACF,CAAC,CAAC,CAAC,mH;;;;;;;;;;;;;;;;;;AC7DJ,IAAI,CAAC,YAAY,CAAC,MAAM,GAAG;AACzB,cAAY,EAAE,UAAS,OAAO,EAAE;AAC9B,WAAO,OAAO,CAAC,SAAS,IAAI,IAAI,CAAC,iBAAiB;GACnD;AACD,cAAY,EAAE,UAAS,OAAO,EAAE;AAC9B,WAAO,OAAO,CAAC,SAAS,IAAI,IAAI,CAAC,iBAAiB,CAAC,eAAe;GACnE;CACF,sH;;;;;;;;;;;;;;;;;;ACPD,IAAI,CAAC,YAAY,CAAC,IAAI,GAAG;AACvB,qBAAmB,EAAE,UAAS,OAAO,EAAE;AACrC,gBAAY,GAAG;AACb,iBAAW,EAAE,MAAM;AACnB,kBAAY,EAAE,4BAA4B;AAC1C,iBAAW,EAAE,aAAa;AAC1B,sBAAgB,EAAE,KAAK;AACvB,oBAAc,EAAE,KAAK;AACrB,sBAAgB,EAAE,KAAK;KACxB;;AAED,QAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAE,EAAE,EAAC,IAAI,EAAE,YAAY,EAAC,CAAC;AAC9C,WAAO,IAAI,CAAC,QAAQ,CAAC,OAAO,EAAE,CAAC,GAAG;GACnC;CACF,sH;;;;;;;;;;;;;;;;;;ACdD,IAAI,CAAC,QAAQ,GAAG,IAAI,KAAK,CAAC,UAAU,CAAC,cAAc,CAAC,CAAC;;AAErD,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,IAAI,YAAY,CAAC;AAC1C,cAAY,EAAE;AACZ,QAAI,EAAE,MAAM;GACb;AACD,MAAI,EAAE;AACJ,QAAI,EAAE,MAAM;AACZ,SAAK,EAAE,MAAM;AACb,OAAG,EAAE,EAAE;GACR;AACD,aAAW,EAAE;AACX,QAAI,EAAE,MAAM;AACZ,SAAK,EAAE,aAAa;AACpB,YAAQ,EAAE,IAAI;AACd,OAAG,EAAE,IAAI;GACV;AACD,aAAW,EAAE;AACX,QAAI,EAAE,OAAO;AACb,SAAK,EAAE,wBAAwB;AAC/B,aAAS,EAAE,YAAW;;AAEpB,UAAI,CAAC,KAAK,EAAE;AACZ,UAAG,IAAI,CAAC,QAAQ,EAAE;AAChB,eAAO,KAAK;OACb;KACF;GACF;AACD,WAAS,EAAE;AACT,QAAI,EAAE,OAAO;AACb,aAAS,EAAE,YAAW;;AAEpB,UAAI,CAAC,KAAK,EAAE;AACZ,UAAG,IAAI,CAAC,QAAQ,EAAE;AAChB,eAAO,KAAK;OACb;KACF;GACF;AACD,WAAS,EAAE;AACT,QAAI,EAAE,IAAI;AACV,aAAS,EAAE,YAAW;AACpB,UAAG,IAAI,CAAC,QAAQ,EAAE;AAChB,eAAO,IAAI,IAAI,EAAE;OAClB;;AAED,UAAI,CAAC,KAAK,EAAE;KACb;GACF;AACD,WAAS,EAAE;AACT,QAAI,EAAE,MAAM;AACZ,YAAQ,EAAE,IAAI;GACf;AACD,MAAI,EAAE;AACJ,QAAI,EAAE,MAAM;AACZ,YAAQ,EAAE,IAAI;GACf;CACF,CAAC,CAAC,CAAC;;AAEJ,IAAI,CAAC,OAAO,GAAG;AACb,OAAK,EAAE;AACL,QAAI,EAAE,MAAM;AACZ,OAAG,EAAE,KAAK;AACV,SAAK,EAAE,OAAO;GACf;AACD,QAAM,EAAE,YAAW;AACjB,WAAO,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;GACpC;CACF,sH;;;;;;;;;;;;;;;;;;ACnED,IAAI,CAAC,MAAM,GAAG,IAAI,KAAK,CAAC,UAAU,CAAC,YAAY,CAAC,CAAC;;AAEjD,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,IAAI,YAAY,CAAC;AACxC,WAAS,EAAE;AACT,QAAI,EAAE,MAAM;GACb;AACD,MAAI,EAAE;AACJ,QAAI,EAAE,MAAM;AACZ,iBAAa,EAAE,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE;GACrC;AACD,cAAY,EAAE;AACZ,QAAI,EAAE,MAAM;GACb;CACF,CAAC,CAAC,oH;;;;;;;;;;;;;;;;;;ACbH,IAAI,CAAC,SAAS,GAAG,IAAI,KAAK,CAAC,UAAU,CAAC,eAAe,EAAE;AACrD,WAAS,EAAE,UAAU,GAAG,EAAE;AAAE,WAAO,IAAI,QAAQ,CAAC,GAAG,CAAC,CAAC;GAAE;CACxD,CAAC,CAAC;;AAEH,IAAI,QAAQ,GAAG,UAAS,GAAG,EAAE;AAC3B,GAAC,CAAC,MAAM,CAAC,IAAI,EAAE,GAAG,CAAC;CACpB;;AAED,CAAC,CAAC,MAAM,CAAC,QAAQ,CAAC,SAAS,EAAE;AAC3B,UAAQ,EAAE,YAAW;AACnB,WAAO,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,mBAAmB;GAChD;AACD,eAAa,EAAE,YAAW;AACxB,QAAI,gBAAgB;AACpB,QAAG,IAAI,CAAC,CAAC,CAAC,IAAI,KAAK,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,EAAE;AAC1C,sBAAgB,GAAG,IAAI,CAAC,uBAAuB;KAChD,MAAM,IAAG,IAAI,CAAC,CAAC,CAAC,IAAI,KAAK,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,GAAG,EAAE;AAChD,sBAAgB,GAAG,IAAI,CAAC,sBAAsB;KAC/C,MAAM,IAAG,IAAI,CAAC,CAAC,CAAC,IAAI,KAAK,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,KAAK,EAAE;AAClD,sBAAgB,GAAG,IAAI,CAAC,wBAAwB;KACjD,MAAM;AACL,YAAM,IAAI,MAAM,CAAC,KAAK,CAAC,cAAc,EAAE,uBAAuB,CAAC;KAChE;AACD,WAAO,IAAI,CAAC,QAAQ,EAAE,GAAG,gBAAgB;GAC1C;CACF,CAAC;;AAEF,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,MAAM,CAAC,UAAS,MAAM,EAAE,GAAG,EAAE;AAChD,MAAI,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,EAAC,GAAG,EAAE,GAAG,CAAC,MAAM,EAAE,KAAK,EAAE,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAC,CAAC;AAClF,MAAG,IAAI,IAAI,IAAI,CAAC,SAAS,EAAE,CAAC,MAAM,KAAK,CAAC,EACtC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC;CAC9B,CAAC;;AAEF,IAAI,CAAC,QAAQ,GAAG;AACd,UAAQ,EAAE,UAAS,UAAU,EAAE;AAC7B,WAAO,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,UAAU,CAAC;GAC1C;AACD,QAAM,EAAE,UAAS,UAAU,EAAE;AAC3B,WAAO,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,UAAU,CAAC;GACzC;CACF;;AAED,IAAI,CAAC,SAAS,CAAC,YAAY,CAAC,IAAI,YAAY,CAAC;AAC3C,QAAM,EAAE;AACN,QAAI,EAAE,MAAM;AACZ,cAAU,EAAE,IAAI;AAChB,aAAS,EAAE,YAAW;AACpB,UAAG,MAAM,CAAC,QAAQ,EAAE;AAClB,YAAI,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC,KAAK;AAC7C,YAAI,OAAO,GAAG,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,SAAS,CAAC;AAC9C,YAAI,UAAU,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,OAAO,CAAC,YAAY,CAAC;;;AAG/D,YAAG,CAAC,CAAC,IAAI,CAAC,MAAM,EAAE;AAChB,cAAI,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC;AAC5B,wBAAY,EAAE,UAAU,CAAC,GAAG;AAC5B,iBAAK,EAAE,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,QAAQ;AAChC,kBAAM,EAAE,IAAI,CAAC,MAAM;WACpB,CAAC;;AAEF,cAAG,IAAI,EACL,OAAO,IAAI,CAAC,GAAG;;AAEjB,cAAI,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC;AAC7B,wBAAY,EAAE,UAAU,CAAC,GAAG;AAC5B,sBAAU,EAAE,UAAU,CAAC,MAAM;AAC7B,iBAAK,EAAE,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,QAAQ;AAChC,kBAAM,EAAE,IAAI,CAAC,MAAM;WACpB,CAAC;;AAEF,iBAAO,MAAM;SACd,MAAM;AACL,cAAI,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,KAAK;;AAEzC,cAAG,CAAC,CAAC,OAAO,EAAE;AACZ,gBAAI,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC;AAC3B,0BAAY,EAAE,YAAY;AAC1B,mBAAK,EAAE,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,QAAQ;AAChC,qBAAO,EAAE,OAAO;aACjB,EAAE,EAAC,IAAI,EAAE;AACR,4BAAY,EAAE,UAAU,CAAC,GAAG;AAC5B,0BAAU,EAAE,UAAU,CAAC,MAAM;AAC7B,qBAAK,EAAE,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,QAAQ;AAChC,uBAAO,EAAE,OAAO;eACjB,EAAC,CAAC;AACH,mBAAO,IAAI,CAAC,UAAU;WACvB,MAAM;;AAEL,mBAAO,SAAS;WACjB;SACF;OACF;KACF;GACF;AACD,SAAO,EAAE;AACP,QAAI,EAAE,MAAM;AACZ,YAAQ,EAAE,IAAI;GACf;AACD,WAAS,EAAE;AACT,QAAI,EAAE,MAAM;AACZ,cAAU,EAAE,IAAI;GACjB;AACD,MAAI,EAAE;AACJ,QAAI,EAAE,MAAM;AACZ,iBAAa,EAAE,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE;GACrC;AACD,UAAQ,EAAE;AACR,QAAI,EAAE,MAAM;GACb;AACD,aAAW,EAAE;AACX,QAAI,EAAE,IAAI;GACX;AACD,aAAW,EAAE;AACX,QAAI,EAAE,MAAM;GACb;AACD,eAAa,EAAE;AACb,QAAI,EAAE,MAAM;GACb;AACD,uBAAqB,EAAE;AACrB,QAAI,EAAE,MAAM;AACZ,aAAS,EAAE,YAAW;;AAEpB,UAAG,IAAI,CAAC,QAAQ,EAAE;AAChB,YAAG,MAAM,CAAC,QAAQ,EAAC;AACjB,cAAI,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC,KAAK;AAC7C,cAAI,OAAO,GAAG,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,SAAS,CAAC;AAC9C,iBAAO,OAAO,CAAC,IAAI,CAAC;SACrB;AACD,eAAO,YAAY;OACpB;;AAED,UAAI,CAAC,KAAK,EAAE;KACb;AACD,cAAU,EAAE,IAAI;GACjB;AACD,wBAAsB,EAAE;AACtB,QAAI,EAAE,MAAM;AACZ,aAAS,EAAE,YAAW;AACpB,UAAG,IAAI,CAAC,QAAQ,EAAE;AAChB,YAAG,MAAM,CAAC,QAAQ,EAAE;;AAClB,cAAI,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC,KAAK;AAC7C,iBAAO,aAAa,CAAC,SAAS,EAAE,KAAK,CAAC;SACvC;AACD,eAAO,YAAY;OACpB;AACD,UAAI,CAAC,KAAK,EAAE;KACb;GACF;AACD,0BAAwB,EAAE;AACxB,QAAI,EAAE,MAAM;AACZ,aAAS,EAAE,YAAW;AACpB,UAAG,IAAI,CAAC,QAAQ,EAAE;AAChB,YAAG,MAAM,CAAC,QAAQ,EAAE;;AAClB,cAAI,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC,KAAK;AAC7C,iBAAO,aAAa,CAAC,SAAS,EAAE,MAAM,CAAC;SACxC;AACD,eAAO,YAAY;OACpB;AACD,UAAI,CAAC,KAAK,EAAE;KACb;GACF;AACD,mBAAiB,EAAE;AACjB,QAAI,EAAE,MAAM;AACZ,aAAS,EAAE,YAAW;AACpB,UAAG,IAAI,CAAC,QAAQ,EAAE;AAChB,YAAG,MAAM,CAAC,QAAQ,EAAE;;AAClB,cAAI,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC,KAAK;AAC7C,iBAAO,aAAa,CAAC,SAAS,EAAE,SAAS,CAAC;SAC3C;AACD,eAAO,YAAY;OACpB;AACD,UAAI,CAAC,KAAK,EAAE;KACb;GACF;AACD,oBAAkB,EAAE;AAClB,QAAI,EAAE,MAAM;AACZ,aAAS,EAAE,YAAW;AACpB,UAAG,IAAI,CAAC,QAAQ,EAAE;AAChB,YAAG,MAAM,CAAC,QAAQ,EAAE;;AAClB,cAAI,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC,KAAK;AAC7C,iBAAO,aAAa,CAAC,SAAS,EAAE,UAAU,CAAC;SAC5C;OACF;AACD,UAAI,CAAC,KAAK,EAAE;KACb;AACD,YAAQ,EAAE,IAAI;GACf;AACD,gBAAc,EAAE;AACd,QAAI,EAAE,MAAM;AACZ,aAAS,EAAE,YAAW;AACpB,UAAG,IAAI,CAAC,QAAQ,EAAE;AAChB,YAAG,MAAM,CAAC,QAAQ,EAAE;;AAClB,cAAI,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC,KAAK;AAC7C,iBAAO,aAAa,CAAC,SAAS,EAAE,MAAM,CAAC;SACxC;AACD,eAAO,YAAY;OACpB;AACD,UAAI,CAAC,KAAK,EAAE;KACb;GACF;AACD,iBAAe,EAAE;AACf,QAAI,EAAE,MAAM;AACZ,aAAS,EAAE,YAAW;AACpB,UAAG,IAAI,CAAC,QAAQ,EAAE;AAChB,YAAG,MAAM,CAAC,QAAQ,EAAE;;AAClB,cAAI,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC,KAAK;AAC7C,iBAAO,aAAa,CAAC,SAAS,EAAE,OAAO,CAAC;SACzC;AACD,eAAO,YAAY;OACpB;AACD,UAAI,CAAC,KAAK,EAAE;KACb;GACF;AACD,eAAa,EAAE;AACb,QAAI,EAAE,MAAM;AACZ,aAAS,EAAE,YAAW;AACpB,UAAG,IAAI,CAAC,QAAQ,EAAE;AAChB,YAAG,MAAM,CAAC,QAAQ,EAAE;;AAClB,cAAI,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC,KAAK;AAC7C,iBAAO,aAAa,CAAC,SAAS,EAAE,KAAK,CAAC;SACvC;AACD,eAAO,YAAY;OACpB;AACD,UAAI,CAAC,KAAK,EAAE;KACb;GACF;AACD,qBAAmB,EAAE;AACnB,QAAI,EAAE,MAAM;AACZ,aAAS,EAAE,YAAW;AACpB,UAAG,IAAI,CAAC,QAAQ,EAAE;AAChB,YAAG,MAAM,CAAC,QAAQ,EAAE;;AAClB,cAAI,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC,KAAK;AAC7C,cAAI,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,KAAK;;AAEnC,cAAI,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,EAAC,SAAS,EAAE,SAAS,EAAE,IAAI,EAAE,IAAI,EAAC,CAAC;;AAEnE,iBAAO,KAAK,CAAC,YAAY,CAAC;SAC3B;AACD,eAAO,CAAC;OACT;AACD,UAAI,CAAC,KAAK,EAAE;KACb;GAEF;;AACD,WAAS,EAAE;AACT,QAAI,EAAE,IAAI;AACV,aAAS,EAAE,YAAW;AACpB,UAAG,IAAI,CAAC,QAAQ,EAAE;AAChB,eAAO,IAAI,IAAI,EAAE;OAClB;AACD,UAAI,CAAC,KAAK,EAAE;KACb;AACD,cAAU,EAAE,IAAI;GACjB;CACF,CAAC,CAAC,CAAC;;AAEJ,IAAI,aAAa,GAAG,UAAS,SAAS,EAAE,QAAQ,EAAE;AAChD,MAAI,OAAO,GAAG,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,SAAS,CAAC;;AAE9C,MAAG,OAAO,EAAE;AACV,cAAU,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,OAAO,CAAC,YAAY,CAAC;AAC3D,WAAO,UAAU,CAAC,QAAQ,CAAC,CAAC;GAC7B;CACF,sH;;;;;;;;;;;;;;;;;;ACvQD,IAAI,CAAC,YAAY,GAAG,IAAI,KAAK,CAAC,UAAU,CAAC,kBAAkB,CAAC,CAAC;;;;;;AAM7D,IAAI,CAAC,YAAY,CAAC,YAAY,CAAC,IAAI,YAAY,CAAC;AAC9C,QAAM,EAAE;AACN,QAAI,EAAE,MAAM;AACZ,cAAU,EAAE,IAAI;AAChB,aAAS,EAAE,YAAW;AACpB,aAAO,MAAM,CAAC,MAAM,EAAE;KACvB;GACF;AACD,MAAI,EAAE;AACJ,QAAI,EAAE,MAAM;GACb;AACD,UAAQ,EAAE;AACR,QAAI,EAAE,MAAM;AACZ,cAAU,EAAE,IAAI;GACjB;AACD,OAAK,EAAE;AACL,QAAI,EAAE,MAAM;AACZ,cAAU,EAAE,IAAI;GACjB;AACD,eAAa,EAAE;AACb,QAAI,EAAE,MAAM;AACZ,cAAU,EAAE,IAAI;GACjB;AACD,WAAS,EAAE;AACT,QAAI,EAAE,OAAO;GACd;AACD,SAAO,EAAE;AACP,QAAI,EAAE,MAAM;GACb;AACD,cAAY,EAAE;AACZ,QAAI,EAAE,MAAM;GACb;AACD,SAAO,EAAE;AACP,QAAI,EAAE,MAAM;GACb;AACD,UAAQ,EAAE;AACR,QAAI,EAAE,MAAM;GACb;CACF,CAAC,CAAC,oH;;;;;;;;;;;;;;;;;;AC5CH,IAAI,CAAC,KAAK,GAAG,IAAI,KAAK,CAAC,UAAU,CAAC,WAAW,EAAE;AAC7C,WAAS,EAAE,UAAU,GAAG,EAAE;AAAE,WAAO,IAAI,IAAI,CAAC,GAAG,CAAC,CAAC;GAAE;CACpD,CAAC,CAAC;;AAEH,IAAI,GAAG,UAAS,GAAG,EAAE;AACnB,GAAC,CAAC,MAAM,CAAC,IAAI,EAAE,GAAG,CAAC;CACpB;;AAED,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,SAAS,EAAE;AACvB,UAAQ,EAAE,YAAW;AACnB,QAAI,KAAK,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,EAAC,MAAM,EAAE,IAAI,CAAC,GAAG,EAAC,CAAC,CAAC,KAAK,EAAE;AAC3D,WAAO,CAAC,CAAC,MAAM,CAAC,KAAK,EAAE,UAAS,GAAG,EAAE,IAAI,EAAE;AACzC,aAAO,GAAG,GAAG,IAAI,CAAC,QAAQ,EAAE;KAC7B,EAAE,CAAC,CAAC;GACN;AACD,eAAa,EAAE,YAAW;AACxB,QAAI,KAAK,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,EAAC,MAAM,EAAE,IAAI,CAAC,GAAG,EAAC,CAAC,CAAC,KAAK,EAAE;AAC3D,WAAO,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,EAAE,UAAS,GAAG,EAAE,IAAI,EAAE;AACpD,aAAO,GAAG,GAAG,IAAI,CAAC,aAAa,EAAE;KAClC,EAAE,CAAC,CAAC,CAAC;GACP;AACD,YAAU,EAAE,YAAW;AACrB,WAAO,IAAI,CAAC,QAAQ,EAAE,GAAG,IAAI,CAAC,eAAe;GAC9C;AACD,aAAW,EAAE,YAAW;AACtB,WAAO,IAAI,CAAC,QAAQ,EAAE,GAAG,IAAI,CAAC,UAAU,EAAE;GAC3C;AACD,OAAK,EAAE,YAAW;AAChB,WAAO,IAAI,CAAC,WAAW,EAAE,GAAG,IAAI,CAAC,GAAG,EAAE;GACvC;AACD,WAAS,EAAE,YAAW;AACpB,WAAO,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,EAAC,MAAM,EAAE,IAAI,CAAC,GAAG,EAAC,CAAC,CAAC,KAAK,EAAE;GACvD;AACD,KAAG,EAAE,YAAW;AACd,WAAO,IAAI,CAAC,WAAW,EAAE,GAAG,IAAI,CAAC,OAAO;GACzC;CACF,CAAC;;AAEF,8BAA8B,GAAG,UAAS,MAAM,EAAE;AAChD,MAAI,eAAe,GAAG,kBAAkB,CAAC,MAAM,CAAC;AAChD,SAAO,IAAI,CAAC,OAAO,EAAE;AAClB,MAAI,CAAC,UAAU,EAAE,IAAI,eAAe,CAAC,MAAM,KAAK,MAAM,CAAC,MAAM,EAAG;AAChE,MAAI,CAAC,KAAK,EAAE,IAAI,eAAe,CAAC,KAAK,KAAK,MAAM,CAAC,MAAM,EAAG;CAC9D;;AAED,iBAAiB,GAAG,UAAS,MAAM,EAAE;AACnC,MAAI,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC;AACrC,SAAQ,CAAC,CAAC,IAAI,CAAC,MAAM,IAAI,IAAI,CAAC,MAAM,KAAK,MAAM,CAAC,MAAM,EAAE;AACrD,MAAI,CAAC,OAAO,IAAI,CAAC,IAAI,CAAC,MAAO;CACjC;;AAED,kBAAkB,GAAG,UAAS,MAAM,EAAE;AACpC,MAAI,aAAa,GAAG,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,EAAC,MAAM,EAAE,MAAM,EAAC,CAAC;AAC5D,MAAI,YAAY,GAAG,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,aAAa,CAAC,SAAS,CAAC;AACjE,SAAO,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,YAAY,CAAC,YAAY,CAAC;CAC3D;;AAED,IAAI,CAAC,IAAI,GAAG;AACV,UAAQ,EAAE,oBAAoB;AAC9B,YAAU,EAAE,sBAAsB;AAClC,QAAM,EAAE;AACN,YAAQ,EAAE,0BAA0B;AACpC,2BAAuB,EAAE,yCAAyC;AAClE,kBAAc,EAAE,gCAAgC;AAChD,+BAA2B,EAAE,6CAA6C;AAC1E,uBAAmB,EAAE,qCAAqC;AAC1D,WAAO,EAAE,yBAAyB;AAClC,yBAAqB,EAAE,uCAAuC;AAC9D,wBAAoB,EAAE,sCAAsC;AAC5D,sBAAkB,EAAE,oCAAoC;GACzD;CACF;;AAED,IAAI,CAAC,KAAK,CAAC,YAAY,CAAC,IAAI,YAAY,CAAC;AACvC,OAAK,EAAE;AACL,QAAI,EAAE,MAAM;GACb;AACD,YAAU,EAAE;AACV,QAAI,EAAE,MAAM;GACb;AACD,cAAY,EAAE;AACZ,QAAI,EAAE,MAAM;GACb;AACD,QAAM,EAAE;AACN,QAAI,EAAE,MAAM;AACZ,YAAQ,EAAE,IAAI;GACf;AACD,SAAO,EAAE;AACP,QAAI,EAAE,MAAM;AACZ,YAAQ,EAAE,IAAI;GACf;AACD,QAAM,EAAE;AACN,QAAI,EAAE,MAAM;AACZ,YAAQ,EAAE,IAAI;GACf;AACD,WAAS,EAAE;AACT,QAAI,EAAE,MAAM;AACZ,YAAQ,EAAE,IAAI;GACf;AACD,2BAAyB,EAAE;AACzB,QAAI,EAAE,OAAO;AACb,YAAQ,EAAE,IAAI;GACf;AACD,kBAAgB,EAAE;AAChB,QAAI,EAAE,MAAM;AACZ,YAAQ,EAAE,IAAI;GACf;AACD,iBAAe,EAAE;AACf,QAAI,EAAE,MAAM;AACZ,YAAQ,EAAE,IAAI;GACf;AACD,cAAY,EAAE;AACZ,QAAI,EAAE,MAAM;AACZ,YAAQ,EAAE,IAAI;GACf;AACD,cAAY,EAAE;AACZ,QAAI,EAAE,MAAM;AACZ,YAAQ,EAAE,IAAI;GACf;AACD,iBAAe,EAAE;AACf,QAAI,EAAE,MAAM;AACZ,YAAQ,EAAE,IAAI;GACf;AACD,gBAAc,EAAE;AACd,QAAI,EAAE,MAAM;AACZ,YAAQ,EAAE,IAAI;GACf;AACD,iBAAe,EAAE;AACf,QAAI,EAAE,MAAM;AACZ,YAAQ,EAAE,IAAI;GACf;AACD,aAAW,EAAE;AACX,QAAI,EAAE,MAAM;AACZ,YAAQ,EAAE,IAAI;GACf;AACD,YAAU,EAAE;AACV,QAAI,EAAE,MAAM;AACZ,YAAQ,EAAE,IAAI;GACf;AACD,YAAU,EAAE;AACV,QAAI,EAAE,MAAM;AACZ,YAAQ,EAAE,IAAI;GACf;AACD,eAAa,EAAE;AACb,QAAI,EAAE,MAAM;AACZ,YAAQ,EAAE,IAAI;GACf;AACD,aAAW,EAAE;AACX,QAAI,EAAE,MAAM;AACZ,YAAQ,EAAE,IAAI;GACf;AACD,KAAG,EAAE;AACH,QAAI,EAAE,MAAM;AACZ,YAAQ,EAAE,IAAI;GACf;AACD,WAAS,EAAE;AACT,QAAI,EAAE,IAAI;AACV,YAAQ,EAAE,IAAI;GACf;AACD,qBAAmB,EAAE;AACnB,QAAI,EAAE,MAAM;AACZ,YAAQ,EAAE,IAAI;GACf;AACD,eAAa,EAAE;AACb,QAAI,EAAE,MAAM;AACZ,YAAQ,EAAE,IAAI;GACf;AACD,gBAAc,EAAE;AACd,QAAI,EAAE,IAAI;AACV,YAAQ,EAAE,IAAI;GACf;AACD,aAAW,EAAE;AACX,QAAI,EAAE,IAAI;AACV,YAAQ,EAAE,IAAI;GACf;AACD,eAAa,EAAE;AACb,QAAI,EAAE,IAAI;AACV,YAAQ,EAAE,IAAI;GACf;AACD,4BAA0B,EAAE;AAC1B,QAAI,EAAE,MAAM;AACZ,YAAQ,EAAE,IAAI;GACf;AACD,+BAA6B,EAAE;AAC7B,QAAI,EAAE,MAAM;AACZ,YAAQ,EAAE,IAAI;GACf;AACD,oBAAkB,EAAE;AAClB,QAAI,EAAE,IAAI;AACV,YAAQ,EAAE,IAAI;GACf;AACD,sBAAoB,EAAE;AACpB,QAAI,EAAE,MAAM;AACZ,YAAQ,EAAE,IAAI;GACf;AACD,gBAAc,EAAE;AACd,QAAI,EAAE,MAAM;AACZ,YAAQ,EAAE,IAAI;GACf;AACD,WAAS,EAAE;AACT,QAAI,EAAE,IAAI;AACV,YAAQ,EAAE,IAAI;GACf;AACD,2BAAyB,EAAE;AACzB,QAAI,EAAE,MAAM;AACZ,YAAQ,EAAE,IAAI;GACf;CACF,CAAC,CAAC,CAAC,mH;;;;;;;;;;;;;;;;;;AC/MJ,MAAM,CAAC,OAAO,CAAC,kBAAkB,EAAE,YAAW;;AAE5C,MAAG,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE;;AAE3B,WAAO,CACL,IAAI,CAAC,WAAW,CAAC,IAAI,EAAE,EACvB,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,EAAC,gBAAgB,EAAE,aAAa,EAAC,CAAC,CACpD;GACJ,MAAM,IAAG,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE;;AAErC,WAAO,CACL,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,EAAC,MAAM,EAAE,IAAI,CAAC,MAAM,EAAE,SAAS,EAAE,KAAK,EAAC,CAAC,EAC9D,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,EAAC,gBAAgB,EAAE,aAAa,EAAC,CAAC,CACpD;GACJ,MAAM,IAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE;;AAEhC,WAAO,CACL,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,EAAC,KAAK,EAAE,IAAI,CAAC,MAAM,EAAE,SAAS,EAAE,KAAK,EAAC,CAAC,EAC7D,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,EAAC,gBAAgB,EAAE,aAAa,EAAC,CAAC,CACpD;GACJ,MAAM;;AAEL,WAAO,CACL,IAAI,CAAC,WAAW,CAAC,IAAI,CACnB,EAAC,WAAW,EAAE,IAAI,EAAE,SAAS,EAAE,KAAK,EAAC,EACrC,EAAC,MAAM,EAAE;AACP,WAAG,EAAE,CAAC;AACN,YAAI,EAAE,CAAC;AACP,mBAAW,EAAE,CAAC;AACd,eAAO,EAAE,CAAC;AACV,gBAAQ,EAAE,CAAC;AACX,YAAI,EAAE,CAAC;AACP,aAAK,EAAE,CAAC;AACR,WAAG,EAAE,CAAC;AACN,cAAM,EAAE,CAAC;OACV,EAAC,CAAC,EACL,IAAI,CAAC,MAAM,CAAC,IAAI,EAAE,CACnB;GACF;CAEF,CAAC,CAAC;;AAEH,MAAM,CAAC,OAAO,CAAC,iBAAiB,EAAE,UAAS,YAAY,EAAE;AACvD,OAAK,CAAC,YAAY,EAAE,MAAM,CAAC;AAC3B,MAAI,UAAU,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,YAAY,CAAC;;AAEvD,MAAG,CAAC,UAAU,EACZ,OAAM;;AAER,MAAG,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE;;AAE3B,WAAO,CACL,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,EAAC,GAAG,EAAE,YAAY,EAAC,CAAC,EAC1C,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAC,YAAY,EAAE,YAAY,EAAC,CAAC,EAChD,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,EAAC,QAAQ,EAAE,YAAY,EAAE,gBAAgB,EAAE,aAAa,EAAC,CAAC,EAC3E,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,UAAU,CAAC,MAAM,EAAE,EAAC,MAAM,EAAE;AAC5C,eAAO,EAAE,CAAC;OACX,EAAC,CAAC,CACJ;GACJ,MAAM,IAAG,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE;;AAErC,WAAO,CACL,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,EAAC,MAAM,EAAE,IAAI,CAAC,MAAM,EAAE,SAAS,EAAE,KAAK,EAAE,GAAG,EAAE,YAAY,EAAC,CAAC,EACjF,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAC,YAAY,EAAE,YAAY,EAAC,CAAC,EAChD,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,EAAC,QAAQ,EAAE,YAAY,EAAE,gBAAgB,EAAE,aAAa,EAAC,CAAC,EAC3E,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,UAAU,CAAC,MAAM,EAAE,EAAC,MAAM,EAAE;AAC5C,eAAO,EAAE,CAAC;OACX,EAAC,CAAC,CACJ;GACJ,MAAM,IAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE;;AAEhC,WAAO,CACL,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,EAAC,KAAK,EAAE,IAAI,CAAC,MAAM,EAAE,SAAS,EAAE,KAAK,EAAE,GAAG,EAAE,YAAY,EAAC,CAAC,EAChF,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAC,YAAY,EAAE,YAAY,EAAC,CAAC,EAChD,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,EAAC,QAAQ,EAAE,YAAY,EAAE,gBAAgB,EAAE,aAAa,EAAC,CAAC,EAC3E,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,UAAU,CAAC,MAAM,EAAE,EAAC,MAAM,EAAE;AAC5C,eAAO,EAAE,CAAC;OACX,EAAC,CAAC,CACJ;GACJ,MAAM;AACL,WAAO,CACL,IAAI,CAAC,WAAW,CAAC,IAAI,CACnB,EAAC,WAAW,EAAE,IAAI,EAAE,SAAS,EAAE,KAAK,EAAE,GAAG,EAAE,YAAY,EAAC,EACxD,EAAC,MAAM,EAAE;AACP,WAAG,EAAE,CAAC;AACN,YAAI,EAAE,CAAC;AACP,mBAAW,EAAE,CAAC;AACd,eAAO,EAAE,CAAC;AACV,gBAAQ,EAAE,CAAC;AACX,YAAI,EAAE,CAAC;AACP,aAAK,EAAE,CAAC;AACR,WAAG,EAAE,CAAC;AACN,cAAM,EAAE,CAAC;OACV,EAAC,CAAC,EACL,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC;AACf,iBAAW,EAAE,IAAI;AACjB,eAAS,EAAE,KAAK;AAChB,kBAAY,EAAE,YAAY;KAC3B,EACD,EAAC,MAAM,EAAE;AACP,WAAG,EAAE,CAAC;AACN,YAAI,EAAE,CAAC;AACP,mBAAW,EAAE,CAAC;AACd,oBAAY,EAAE,CAAC;AACf,iBAAS,EAAE,CAAC;AACZ,YAAI,EAAE,CAAC;OACR,EAAC,CAAC,EACL,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,EAAC,QAAQ,EAAE,YAAY,EAAE,gBAAgB,EAAE,aAAa,EAAC,CAAC,EAC3E,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,UAAU,CAAC,MAAM,EAAE,EAAC,MAAM,EAAE;AAC5C,eAAO,EAAE,CAAC;OACX,EAAC,CAAC,CACJ;GACF;CACF,CAAC,CAAC,oH;;;;;;;;;;;;;;;;;;ACjHH,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC,CAC5C,OAAO,CAAC,CACP,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,QAAQ,EAC1B,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,EACvB,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,GAAG,CACtB,CAAC,CACD,KAAK,EAAE,C;;;;;;;;;;;;;;;;;;;ACLR,QAAQ,CAAC,eAAe,CAAC,UAAU,IAAI,EAAE;AACvC,MAAG,IAAI,CAAC,MAAM,EAAE;AACd,UAAM,IAAI,MAAM,CAAC,KAAK,CAAC,GAAG,EAAE,oCAAoC,CAAC,CAAC;GACnE,MAAM;AACL,WAAO,IAAI;GACZ;CACF,CAAC,CAAC;;;AAGH,IAAI,aAAa,GAAG,UAAS,KAAK,EAAE;AAClC,MAAI,wBAAwB,GAAG,CAC7B,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,OAAO,EACzB,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,QAAQ,CAC3B;;AAED,MAAI,cAAc,GAAG,CAAC,CAAC,YAAY,CAAC,KAAK,EAAE,wBAAwB,CAAC;AACpE,SAAO,cAAc,CAAC,MAAM,KAAK,KAAK,CAAC,MAAM;CAC9C;AACD,IAAI,QAAQ,GAAG,YAAW;;AAExB,MAAI,GAAG,GAAG,KAAK;;AAEf,MAAI,GAAG,KAAK,YAAY,EAAE;AACxB,WAAO,IAAI,CAAC,UAAU,CAAC,aAAa,CAAC;GACtC,MAAM;AACL,WAAO,WAAW;GACnB;CACF;;AAED,MAAM,CAAC,OAAO,CAAC;AACb,4BAA0B,EAAE,UAAS,KAAK,EAAE;AAC1C,SAAK,CAAC,KAAK,EAAE,KAAK,CAAC,KAAK,CAAC,CAAC,MAAM,CAAC,EAAE,SAAS,EAAE,IAAI,CAAC,CAAC;AACpD,SAAK,GAAG,KAAK,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,OAAO,CAAC;;AAE5C,QAAG,aAAa,CAAC,KAAK,CAAC,EAAE;AACvB,OAAC,CAAC,IAAI,CAAC,KAAK,EAAE,UAAS,IAAI,EAAE;AAC3B,aAAK,CAAC,eAAe,CAAC,MAAM,CAAC,MAAM,EAAE,EAAE,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;OACzE,CAAC;AACF,YAAM,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,MAAM,EAAE,EAAE,EAAC,IAAI,EAAE;AAC1C,yBAAe,EAAE,QAAQ,EAAE;AAC3B,yBAAe,EAAE,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC;SAC/C,EAAC,CAAC;;AAEH,cAAQ,CAAC,qBAAqB,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC;KAChD,MAAM;AACL,YAAM,IAAI,MAAM,CAAC,KAAK,CAAC,GAAG,EAAE,iDAAiD,CAAC,CAAC;KAChF;GACF;CACF,CAAC,CAAC;;AAEH,MAAM,CAAC,OAAO,CAAC,sBAAsB,EAAE,YAAY;AACjD,MAAI,IAAI,CAAC,MAAM,EAAE;AACf,WAAO,MAAM,CAAC,KAAK,CAAC,IAAI,CACtB,EAAC,GAAG,EAAE,IAAI,CAAC,MAAM,EAAC,EAClB,EAAC,MAAM,EAAE,EAAC,iBAAiB,EAAE,CAAC,EAAE,iBAAiB,EAAE,CAAC,EAAC,EAAC,CAAC,CAAC;GAC3D,MAAM;AACL,QAAI,CAAC,KAAK,EAAE,CAAC;GACd;CACF,CAAC,CAAC,oH;;;;;;;;;;;;;;;;;;AC3DH,MAAM,CAAC,OAAO,CAAC,WAAW,EAAE,UAAS,MAAM,EAAE;AAC3C,OAAK,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;;AAEtB,MAAG,MAAM,KAAK,IAAI,CAAC,MAAM,EAAE;AACzB,WAAO,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,EAAE,EAAC,MAAM,EAAE;AACxC,cAAM,EAAE,CAAC;AACT,eAAO,EAAE,CAAC;AACV,aAAK,EAAE,CAAC;OACT,EAAC,CAAC;GACJ;CACF,CAAC,CAAC;;AAEH,MAAM,CAAC,OAAO,CAAC,cAAc,EAAE,UAAS,MAAM,EAAC;AAC7C,OAAK,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;AACtB,SAAO,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,EAAE,EAAC,MAAM,EAAE;AACxC,aAAO,EAAE,CAAC;KACX,EAAC,CAAC;CACJ,CAAC,CAAC,oH;;;;;;;;;;;;;;;;;;ACjBH,MAAM,CAAC,OAAO,CAAC,YAAY,EAAE,UAAS,OAAO,EAAE;AAC7C,OAAK,CAAC,OAAO,EAAE,KAAK,CAAC,KAAK,CAAC,MAAM,EAAE,IAAI,EAAE,SAAS,CAAC,CAAC;;AAEpD,MAAI,QAAQ;AACZ,MAAG,IAAI,CAAC,MAAM,EAAE;AACd,YAAQ,GAAG,EAAC,MAAM,EAAE,IAAI,CAAC,MAAM,EAAC;GACjC,MAAM;AACL,YAAQ,GAAG,EAAC,OAAO,EAAE,OAAO,EAAC;GAC9B;;AAED,SAAO,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,QAAQ,EAAE,EAAC,MAAM,EAAE;AACxC,SAAG,EAAE,CAAC;AACN,WAAK,EAAE,CAAC;AACR,cAAQ,EAAE,CAAC;AACX,aAAO,EAAE,CAAC;AACV,gBAAU,EAAE,CAAC;AACb,WAAK,EAAE,CAAC;KACT,EAAC,CAAC;CACJ,CAAC,CAAC,oH;;;;;;;;;;;;;;;;;;AClBH,MAAM,CAAC,OAAO,CAAC,eAAe,EAAE,UAAS,YAAY,EAAE;AACrD,SAAO,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC;AACxB,YAAQ,EAAE,IAAI;AACd,aAAS,EAAE,KAAK;AAChB,gBAAY,EAAE,YAAY;GAC3B,EACD,EAAC,MAAM,EAAE;AACP,SAAG,EAAE,CAAC;AACN,UAAI,EAAE,CAAC;AACP,iBAAW,EAAE,CAAC;AACd,eAAS,EAAE,CAAC;AACZ,UAAI,EAAE,CAAC;KACR,EAAC,CAAC,CAAC;CACL,CAAC,CAAC;;AAEH,MAAM,CAAC,OAAO,CAAC,cAAc,EAAE,UAAS,SAAS,EAAE;AACjD,OAAK,CAAC,SAAS,EAAE,MAAM,CAAC;;AAExB,MAAI,OAAO,GAAG,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,SAAS,CAAC;;AAE9C,SAAO,CACL,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC;AACjB,eAAW,EAAE,IAAI;AACjB,aAAS,EAAE,KAAK;AAChB,OAAG,EAAE,SAAS;GACb,EACD,EAAC,MAAM,EAAE;AACP,SAAG,EAAE,CAAC;AACN,UAAI,EAAE,CAAC;AACP,iBAAW,EAAE,CAAC;AACd,eAAS,EAAE,CAAC;AACZ,UAAI,EAAE,CAAC;KACR,EAAC,CAAC,EAEL,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC;AAClB,eAAW,EAAE,IAAI;AACjB,aAAS,EAAE,KAAK;AAChB,OAAG,EAAE,OAAO,CAAC,YAAY;GAC1B,EACD,EAAC,MAAM,EAAE;AACP,SAAG,EAAE,CAAC;AACN,UAAI,EAAE,CAAC;AACP,iBAAW,EAAE,CAAC;AACd,aAAO,EAAE,CAAC;AACV,cAAQ,EAAE,CAAC;AACX,UAAI,EAAE,CAAC;AACP,WAAK,EAAE,CAAC;AACR,SAAG,EAAE,CAAC;KACP,EAAC,CAAC,EAEL,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC;AACf,YAAQ,EAAE,SAAS;AACnB,oBAAgB,EAAE,UAAU;GAC7B,CAAC,EAEF,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC;AACf,aAAS,EAAE,SAAS;GACrB,CAAC,CACH;CACF,CAAC,CAAC,oH;;;;;;;;;;;;;;;;;;AC3DH,QAAQ,CAAC,YAAY,CAAC,kCAAkC,EAAE;AACxD,OAAK,EAAE,EAAE;AACT,WAAS,EAAE,IAAI;AACf,MAAI,EAAE,UAAU,IAAI,EAAE,GAAG,EAAE,MAAM,EAAE,GAAG,EAAE;AACtC,QAAI,UAAU,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC;AACxC,SAAG,EAAE,GAAG,CAAC,YAAY;AACrB,eAAS,EAAE,KAAK;KACjB,CAAC;;AAEF,QAAG,CAAC,CAAC,UAAU,EACb,OAAO,MAAM,KAAK,UAAU,CAAC,MAAM;;AAErC,WAAO,IAAI,CAAC;GACb;CACF,CAAC,CAAC;;AAEH,QAAQ,CAAC,YAAY,CAAC,kCAAkC,EAAE;AACxD,OAAK,EAAE,EAAE;AACT,WAAS,EAAE,IAAI;AACf,MAAI,EAAE,UAAU,IAAI,EAAE,GAAG,EAAE,MAAM,EAAE,GAAG,EAAE;AACtC,QAAI,UAAU,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC;AACxC,SAAG,EAAE,GAAG,CAAC,YAAY;AACrB,eAAS,EAAE,KAAK;KACjB,CAAC;;AAEF,QAAG,CAAC,CAAC,UAAU,EACb,OAAO,MAAM,KAAK,UAAU,CAAC,KAAK;;AAEpC,WAAO,IAAI,CAAC;GACb;CACF,CAAC,CAAC;;AAEH,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC,CACvC,OAAO,CAAC,CACP,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,QAAQ,CAC3B,CAAC,CACD,gCAAgC,EAAE,CAClC,KAAK,EAAE,CAAC;;AAEX,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC,CACvC,OAAO,CAAC,CACP,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,EACvB,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,GAAG,CACtB,CAAC,CACD,gCAAgC,EAAE,CAClC,KAAK,EAAE,C;;;;;;;;;;;;;;;;;;AC7CV,QAAQ,CAAC,YAAY,CAAC,+BAA+B,EAAE;AACrD,OAAK,EAAE,EAAE;AACT,WAAS,EAAE,IAAI;AACf,MAAI,EAAE,UAAU,IAAI,EAAE,GAAG,EAAE,MAAM,EAAE,GAAG,EAAE;AACtC,QAAI,OAAO,GAAG,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC;AAClC,SAAG,EAAE,GAAG,CAAC,SAAS;AAClB,eAAS,EAAE,KAAK;KACjB,CAAC;;AAEF,QAAG,CAAC,CAAC,OAAO,EAAE;AACZ,UAAI,UAAU,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC;AACxC,WAAG,EAAE,OAAO,CAAC,YAAY;AACzB,iBAAS,EAAE,KAAK;OACjB,CAAC;;AAEF,UAAG,CAAC,CAAC,UAAU,EACb,OAAO,MAAM,KAAK,UAAU,CAAC,MAAM;KACtC;AACD,WAAO,IAAI,CAAC;GACb;CACF,CAAC,CAAC;;AAEH,QAAQ,CAAC,YAAY,CAAC,+BAA+B,EAAE;AACrD,OAAK,EAAE,EAAE;AACT,WAAS,EAAE,IAAI;AACf,MAAI,EAAE,UAAU,IAAI,EAAE,GAAG,EAAE,MAAM,EAAE,GAAG,EAAE;AACtC,QAAI,OAAO,GAAG,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC;AAClC,SAAG,EAAE,GAAG,CAAC,SAAS;AAClB,eAAS,EAAE,KAAK;KACjB,CAAC;;AAEF,QAAG,CAAC,CAAC,OAAO,EAAE;AACZ,UAAI,UAAU,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC;AACxC,WAAG,EAAE,OAAO,CAAC,YAAY;AACzB,iBAAS,EAAE,KAAK;OACjB,CAAC;;AAEF,UAAG,CAAC,CAAC,UAAU,EACb,OAAO,MAAM,KAAK,UAAU,CAAC,KAAK;KACrC;;AAED,WAAO,IAAI,CAAC;GACb;CACF,CAAC,CAAC;;AAEH,QAAQ,CAAC,YAAY,CAAC,iBAAiB,EAAE;AACvC,OAAK,EAAE,EAAE;AACT,WAAS,EAAE,IAAI;AACf,MAAI,EAAE,UAAU,IAAI,EAAE,GAAG,EAAE,MAAM,EAAE,GAAG,EAAE;AACtC,QAAI,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC;AAC9B,UAAI,EAAE,GAAG,CAAC,IAAI;AACd,eAAS,EAAE,GAAG,CAAC,SAAS;KACzB,CAAC;;AAEF,WAAO,CAAC,CAAC,KAAK;GACf;CACF,CAAC,CAAC;;AAGH,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,QAAQ,CAAC,CAAC,CAC3B,OAAO,CAAC,CACP,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,QAAQ,CAC3B,CAAC,CACD,6BAA6B,EAAE,CAC/B,eAAe,EAAE,CACjB,KAAK,EAAE,CAAC;;AAEX,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,QAAQ,CAAC,CAAC,CAC3B,OAAO,CAAC,CACP,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,EACvB,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,GAAG,CACtB,CAAC,CACD,6BAA6B,EAAE,CAC/B,eAAe,EAAE,CACjB,KAAK,EAAE,CAAC;;AAEX,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,QAAQ,CAAC,CAAC,CAC3B,OAAO,CAAC,CACP,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,QAAQ,CAC3B,CAAC,CACD,6BAA6B,EAAE,CAC/B,KAAK,EAAE,CAAC;;AAEX,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,QAAQ,CAAC,CAAC,CAC3B,OAAO,CAAC,CACP,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,EACvB,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,GAAG,CACtB,CAAC,CACD,6BAA6B,EAAE,CAC/B,KAAK,EAAE,C;;;;;;;;;;;;;;;;;;ACzFV,MAAM,CAAC,OAAO,CAAC,eAAe,EAAE,YAAW;AACzC,SAAO,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAE,CAAC;CAC9B,CAAC,CAAC;;AAEH,MAAM,CAAC,OAAO,CAAC;AACb,4BAA0B,EAAE,UAAU,eAAe,EAAE;AACrD,SAAK,CAAC,eAAe,EAAE,MAAM,CAAC;;AAE9B,WAAO,IAAI,CAAC,YAAY,CAAC,eAAe,CAAC,CAAC,mBAAmB,EAAE,CAAC;GACjE;CAKF,CAAC,CAAC;;;;;;;;;;;;;;;;;;;;;;;ACbH,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,MAAM,EAAE;;;AAGjC,qBAAmB,EAAE,YAAW;AAC9B,QAAI,eAAe,GAAG,MAAM,CAAC,SAAS,CAAC,MAAM,CAAC,QAAQ,CAAC,QAAQ,EAAE,MAAM,CAAC,QAAQ,CAAC,CAAC;AAClF,QAAI;AACF,UAAI,MAAM,GAAG,eAAe,EAAE,CAAC;;AAE/B,kBAAY,GAAG;AACb,mBAAW,EAAE,QAAQ;AACrB,oBAAY,EAAE,MAAM,CAAC,aAAa;AAClC,mBAAW,EAAE,MAAM,CAAC,YAAY;AAChC,wBAAgB,EAAE,MAAM,CAAC,iBAAiB;AAC1C,sBAAc,EAAE,MAAM,CAAC,eAAe;AACtC,wBAAgB,EAAE,MAAM,CAAC,iBAAiB;OAC3C;;AAED,UAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAE,EAAE,EAAC,IAAI,EAAE,YAAY,EAAC,CAAC;AAC9C,aAAO,IAAI,CAAC,QAAQ,CAAC,OAAO,EAAE,CAAC,GAAG;KACnC,CAAC,OAAO,KAAK,EAAE;AACd,YAAM,IAAI,MAAM,CAAC,KAAK,CAAC,qBAAqB,EAAE,KAAK,CAAC,OAAO,CAAC,CAAC;KAC9D;GACF;AACD,YAAU,EAAE,UAAS,WAAW,EAAE,IAAI,EAAE;AACtC,WAAO,CAAC,GAAG,CAAC,mBAAmB,CAAC,CAAC;AACjC,QAAI,aAAa,GAAG,IAAI,CAAC,gBAAgB,EAAE;AAC3C,WAAO,CAAC,GAAG,CAAC,aAAa,CAAC,CAAC;AAC3B,QAAI,MAAM,GAAG,SAAS,CAAC,IAAI,CAAC,iBAAiB,CAAC;AAC9C,WAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;AACtB,WAAO,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;AACpB,WAAO,CAAC,GAAG,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;AAC9B,QAAI,YAAY,GAAG,MAAM,CAAC,SAAS,CAAC,MAAM,CAAC,SAAS,CAAC,YAAY,EAAE,MAAM,CAAC,SAAS,CAAC,CAAC;AACrF,WAAO,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC;AAC5B,WAAO,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;AAC1B,WAAO,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;AACrB,WAAO,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC;AACzB,WAAO,CAAC,GAAG,CAAC,aAAa,CAAC,CAAC;AAC3B,QAAI;;AAEF,UAAI,MAAM,GAAG,YAAY,CAAC,aAAa,EAAE,EAAC,MAAM,EAAE,WAAW,EAAC,CAAC,CAAC;AAChE,aAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;AAClB,UAAI,CAAC,cAAc,CAAC,GAAG,MAAM,CAAC,EAAE;AAChC,aAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;AACtB,aAAO,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;;AAEpB,UAAI,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC;AACpC,aAAO,MAAM;KACd,CAAC,OAAO,KAAK,EAAE;AACd,aAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;AACnB,YAAM,IAAI,MAAM,CAAC,KAAK,CAAC,8BAA8B,EAAE,KAAK,CAAC,OAAO,CAAC,CAAC;KACvE;GACF;AACD,kBAAgB,EAAE,YAAW;AAC3B,WAAO,CAAC,GAAG,CAAC,kBAAkB,CAAC,CAAC;AAChC,QAAI,MAAM,GAAG,SAAS,CAAC,IAAI,CAAC,iBAAiB,CAAC;AAC9C,QAAI,gBAAgB,GAAG,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,EAAC,MAAM,EAAE,MAAM,CAAC,MAAM,EAAE,EAAC,CAAC;QACpE,aAAa;;;AAGjB,QAAG,gBAAgB,EAAE;AACnB,mBAAa,GAAG,gBAAgB,CAAC,WAAW;KAC7C,MAAM;;AAEL,UAAI,cAAc,GAAG,MAAM,CAAC,SAAS,CAAC,MAAM,CAAC,SAAS,CAAC,MAAM,EAAE,MAAM,CAAC,SAAS,CAAC,CAAC;;AAEjF,UAAI;;AAEF,YAAI,MAAM,GAAG,cAAc,CAAC,EAAC,WAAW,EAAE,oBAAoB,GAAG,MAAM,CAAC,MAAM,EAAE,EAAC,CAAC,CAAC;AACnF,qBAAa,GAAG,MAAM,CAAC,EAAE;;;AAGzB,YAAI,CAAC,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,EAAC,WAAW,EAAE,aAAa,EAAE,MAAM,EAAE,MAAM,CAAC,MAAM,EAAE,EAAC,CAAC;OACrF,CAAC,OAAO,KAAK,EAAE;AACd,cAAM,IAAI,MAAM,CAAC,KAAK,CAAC,8BAA8B,EAAE,KAAK,CAAC,OAAO,CAAC,CAAC;OACvE;KACF;AACD,WAAO,aAAa;GACrB;CACF,CAAC;;AAEF,MAAM,CAAC,OAAO,CAAC;AACb,2BAAyB,EAAE,UAAS,WAAW,EAAE,IAAI,EAAE;AACrD,SAAK,CAAC,WAAW,EAAE,MAAM,CAAC;AAC1B,SAAK,CAAC,IAAI,EAAE;AACV,WAAK,EAAE,MAAM;AACb,cAAQ,EAAE,MAAM;AAChB,aAAO,EAAE,MAAM;AACf,gBAAU,EAAE,MAAM;AAClB,WAAK,EAAE,MAAM;AACb,aAAO,EAAE,MAAM;KAChB,CAAC;;AAEF,UAAM,GAAG,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,UAAU,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC;AAChE,WAAO,MAAM;GACd;AACD,mCAAiC,EAAE,UAAS,gBAAgB,EAAE,WAAW,EAAE;AACzE,SAAK,CAAC,gBAAgB,EAAE,MAAM,CAAC;AAC/B,SAAK,CAAC,WAAW,EAAE;AACjB,UAAI,EAAE,MAAM;AACZ,WAAK,EAAE,MAAM;AACb,cAAQ,EAAE,MAAM;AAChB,mBAAa,EAAE,MAAM;AACrB,aAAO,EAAE,MAAM;AACf,cAAQ,EAAE,MAAM;AAChB,mBAAa,EAAE,MAAM;KACtB,CAAC;;;AAGF,QAAI,cAAc,GAAI,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,eAAe,CAAC,OAAO,CAAC,EAAC,MAAM,EAAE,MAAM,CAAC,MAAM,EAAE,EAAC,CAAC;QAC7F,MAAM,GAAY,SAAS,CAAC,IAAI,CAAC,iBAAiB,CAAC;;;AAGvD,QAAG,CAAC,cAAc,EAAE;AAClB,UAAI,MAAM,GAAG,oBAAoB,EAAE;AACnC,oBAAc,GAAG,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,eAAe,CAAC,OAAO,CAAC;AAChE,cAAM,EAAE,MAAM,CAAC,MAAM,EAAE;AACvB,WAAG,EAAE,MAAM;OACZ,CAAC;KACH;;;AAGD,WAAO,iBAAiB,CAAC,gBAAgB,EAAE,WAAW,EAAE,cAAc,CAAC;GACxE;CACF,CAAC,CAAC;;AAEH,IAAI,iBAAiB,GAAG,UAAS,gBAAgB,EAAE,WAAW,EAAE,cAAc,EAAE;AAC9E,MAAI,MAAM,GAAG,SAAS,CAAC,IAAI,CAAC,iBAAiB,CAAC;AAC9C,MAAI,iBAAiB,GAAG,MAAM,CAAC,SAAS,CAAC,MAAM,CAAC,QAAQ,CAAC,qBAAqB,EAAE,MAAM,CAAC,QAAQ,CAAC,CAAC;;AAEjG,MAAI;AACF,QAAI,MAAM,GAAG,iBAAiB,CAAC,cAAc,CAAC,WAAW,EACvD,EAAC,gBAAgB,EAAE,gBAAgB,EAAC,CAAC;;AAEvC,WAAO,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,WAAW,EAAE;AACpD,aAAO,EAAE,QAAQ;AACjB,eAAS,EAAE,MAAM,CAAC,oBAAoB;AACtC,kBAAY,EAAE,MAAM,CAAC,EAAE;KACxB,CAAC,CAAC;GAEJ,CAAC,OAAO,KAAK,EAAE;AACd,UAAM,IAAI,MAAM,CAAC,KAAK,CAAC,sCAAsC,EAAE,KAAK,CAAC,OAAO,CAAC,CAAC;GAC/E;CACF;;;AAGD,IAAI,oBAAoB,GAAG,YAAW;AACpC,MAAI,MAAM,GAAG,SAAS,CAAC,IAAI,CAAC,iBAAiB,CAAC;AAC9C,MAAI,aAAa,GAAG,MAAM,CAAC,SAAS,CAAC,MAAM,CAAC,QAAQ,CAAC,MAAM,EAAE,MAAM,CAAC,QAAQ,CAAC,CAAC;AAC9E,MAAI;;AAEF,QAAI,MAAM,GAAG,aAAa,CAAC;AACzB,aAAO,EAAE,IAAI;AACb,aAAO,EAAE,IAAI;AACb,WAAK,EAAE,MAAM,CAAC,IAAI,EAAE,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,OAAO;KACvC,CAAC,CAAC;;;AAGH,WAAO,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,eAAe,CAAC,MAAM,CAAC;AACrD,iBAAW,EAAE,MAAM,CAAC,EAAE;AACtB,qBAAe,EAAE,MAAM,CAAC,IAAI,CAAC,WAAW;AACxC,sBAAgB,EAAE,MAAM,CAAC,IAAI,CAAC,MAAM;AACpC,2BAAqB,EAAE,qBAAqB,CAAC,MAAM,CAAC,YAAY,CAAC,YAAY,CAAC;AAC9E,uBAAiB,EAAE,MAAM,CAAC,iBAAiB;KAC5C,CAAC;GACH,CAAC,OAAO,KAAK,EAAE;AACd,UAAM,IAAI,MAAM,CAAC,KAAK,CAAC,qCAAqC,EAAE,KAAK,CAAC,OAAO,CAAC,CAAC;GAC9E;CACF;;AAED,IAAI,qBAAqB,GAAG,UAAS,UAAU,EAAE;AAC/C,SAAQ,UAAU,KAAK,UAAU,GAAI,IAAI,GAAG,KAAK;CAClD,sH;;;;;;;;;;;;;;;;;;AC5KD,QAAQ,CAAC,YAAY,CAAC,4BAA4B,EAAE;AAClD,OAAK,EAAE,EAAE;AACT,WAAS,EAAE,IAAI;AACf,MAAI,EAAE,UAAU,IAAI,EAAE,GAAG,EAAE,MAAM,EAAE,GAAG,EAAE;AACtC,QAAI,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,EAAC,GAAG,EAAE,GAAG,CAAC,MAAM,EAAE,KAAK,EAAE,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAC,CAAC;AAClF,QAAG,IAAI,EAAE;AACP,UAAG,CAAC,CAAC,MAAM,EAAE;AACX,eAAO,MAAM,KAAK,IAAI,CAAC,MAAM;OAC9B,MAAM;;AAEL,eAAO,IAAI,CAAC,OAAO,KAAK,SAAS;OAClC;KACF;AACD,WAAO,IAAI,CAAC;GACb;CACF,CAAC,CAAC;;AAEH,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC,QAAQ,EAAE,QAAQ,EAAE,QAAQ,CAAC,CAAC,CAClD,0BAA0B,EAAE,CAC5B,KAAK,EAAE,CAAC,+B;;;;;;;;;;;;;;;;;;ACnBX,MAAM,CAAC,OAAO,CAAC,WAAW,EAAE,UAAS,MAAM,EAAE;AAC3C,OAAK,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;AACtB,MAAG,IAAI,CAAC,MAAM,EAAE;AACd,WAAO,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,EAAC,GAAG,EAAE,MAAM,EAAC,CAAC;GACtC;AACD,MAAI,CAAC,KAAK,EAAE,CAAC;CACd,CAAC;;AAEF,MAAM,CAAC,OAAO,CAAC,YAAY,EAAE,UAAS,MAAM,EAAE,OAAO,EAAE;AACrD,OAAK,CAAC,MAAM,EAAE,CAAC,MAAM,CAAC,CAAC,CAAC;AACxB,OAAK,CAAC,OAAO,EAAE,KAAK,CAAC,KAAK,CAAC,MAAM,EAAE,IAAI,EAAE,SAAS,CAAC,CAAC;;AAEpD,MAAI,GAAG,GAAG,IAAI;MAAE,cAAc,GAAG,EAAE;MAAE,eAAe,GAAG,EAAE;MAAE,iBAAiB,GAAG,EAAE;MAC7E,UAAU,GAAG,IAAI;MAAE,cAAc,GAAG,IAAI,CAAC;;;AAG7C,WAAS,oBAAoB,CAAC,MAAM,EAAE;AACpC,QAAI,eAAe,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,EAAC,MAAM,EAAE,MAAM,EAAC,CAAC;;AAE3D,mBAAe,CAAC,MAAM,CAAC,GACrB,KAAK,CAAC,UAAU,CAAC,cAAc,CAAC,eAAe,EAAE,GAAG,EAAE,eAAe,CAAC,CAAC;;AAEzE,kBAAc,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,EAAC,MAAM,EAAE,MAAM,EAAC,CAAC,CAAC,cAAc,CAAC;AACpE,WAAK,EAAE,UAAS,EAAE,EAAE,QAAQ,EAAE;AAC5B,6CAAqC,CAAC,QAAQ,CAAC,CAAC;AAChD,WAAG,CAAC,KAAK,CAAC,eAAe,EAAE,EAAE,EAAE,QAAQ,CAAC;OACzC;AACD,aAAO,EAAE,UAAS,EAAE,EAAE,MAAM,EAAE;AAC5B,WAAG,CAAC,OAAO,CAAC,eAAe,EAAE,EAAE,EAAE,MAAM,CAAC;OACzC;AACD,aAAO,EAAE,UAAS,EAAE,EAAE;AACpB,sBAAc,CAAC,EAAE,CAAC,IAAI,cAAc,CAAC,EAAE,CAAC,CAAC,IAAI,EAAE,CAAC;AAChD,yBAAiB,CAAC,EAAE,CAAC,IAAI,iBAAiB,CAAC,EAAE,CAAC,CAAC,IAAI,EAAE,CAAC;;AAEtD,WAAG,CAAC,OAAO,CAAC,eAAe,EAAE,EAAE,CAAC,CAAC;OAClC;KACF,CAAC,CAAC;GACJ;;AAED,WAAS,qCAAqC,CAAC,QAAQ,EAAE;;AAEvD,QAAI,UAAU,GAAG,QAAQ,CAAC,GAAG;;AAE7B,QAAI,cAAc,GAAG,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAC,GAAG,EAAE,QAAQ,CAAC,SAAS,EAAC,CAAC;AAClE,kBAAc,CAAC,UAAU,CAAC,GACxB,KAAK,CAAC,UAAU,CAAC,cAAc,CAAC,cAAc,EAAE,GAAG,EAAE,cAAc,CAAC;;AAEtE,QAAI,OAAO,GAAG,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,QAAQ,CAAC,SAAS,CAAC;AACvD,QAAI,iBAAiB,GAAG,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,EAAC,GAAG,EAAE,OAAO,CAAC,YAAY,EAAC,CAAC;AACxE,qBAAiB,CAAC,UAAU,CAAC,GAC3B,KAAK,CAAC,UAAU,CAAC,cAAc,CAAC,iBAAiB,EAAE,GAAG,EAAE,iBAAiB,CAAC;GAC/E;;AAED,MAAI,WAAW;AACf,MAAG,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE;;AAE3B,eAAW,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE;GAElC,MAAM,IAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE;;AAEhC,QAAI,iBAAiB,GAAG,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC;AAC5C,WAAK,EAAE,IAAI,CAAC,MAAM;KACnB,CAAC,CAAC,KAAK,EAAE;;AAEV,QAAI,mBAAmB,GAAG,CAAC,CAAC,GAAG,CAAC,iBAAiB,EAAE,UAAS,UAAU,EAAE;AACtE,aAAO,UAAU,CAAC,GAAG;KACtB,CAAC;;AAEF,eAAW,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,EAAC,YAAY,EAAE,EAAC,GAAG,EAAE,mBAAmB,EAAC,EAAC,CAAC;GAE5E,MAAM,IAAG,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE;AACpC,eAAW,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC;AAC5B,UAAI,EAAE,CACJ,EAAC,MAAM,EAAE,IAAI,CAAC,MAAM,EAAC,EACrB,EAAC,KAAK,EAAE,EAAC,GAAG,EAAE,MAAM,EAAC,EAAC,CACvB;KACF,CAAC;GACL,MACI,IAAG,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE;;AAEnC,eAAW,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,EAAC,UAAU,EAAE,IAAI,CAAC,MAAM,EAAC,CAAC;GAE3D,MAAM;;AACL,eAAW,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC;AAC5B,UAAI,EAAE,CACJ,EAAC,OAAO,EAAE,OAAO,EAAC,EAClB,EAAC,KAAK,EAAE,EAAC,GAAG,EAAE,MAAM,EAAC,EAAC,CACvB;KACF,CAAC;GACH;;AAED,YAAU,GAAG,WAAW,CAAC,cAAc,CAAC;AACtC,SAAK,EAAE,UAAS,EAAE,EAAE,IAAI,EAAE;AACxB,0BAAoB,CAAC,EAAE,CAAC,CAAC;AACzB,SAAG,CAAC,KAAK,CAAC,WAAW,EAAE,EAAE,EAAE,IAAI,CAAC,CAAC;KAClC;AACD,WAAO,EAAE,UAAS,EAAE,EAAE,MAAM,EAAE;AAC5B,SAAG,CAAC,OAAO,CAAC,WAAW,EAAE,EAAE,EAAE,MAAM,CAAC,CAAC;KACtC;AACD,WAAO,EAAE,UAAS,EAAE,EAAE;;AAEpB,qBAAe,CAAC,EAAE,CAAC,IAAI,eAAe,CAAC,EAAE,CAAC,CAAC,IAAI,EAAE,CAAC;;AAElD,SAAG,CAAC,OAAO,CAAC,WAAW,EAAE,EAAE,CAAC,CAAC;KAC9B;GACF,CAAC,CAAC;;AAEH,KAAG,CAAC,KAAK,EAAE,CAAC;;;;AAIZ,KAAG,CAAC,MAAM,CAAC,YAAW;AACpB,cAAU,CAAC,IAAI,EAAE,CAAC;AAClB,QAAG,cAAc,EACf,cAAc,CAAC,IAAI,EAAE,CAAC;GACzB,CAAC,CAAC;CACJ,CAAC,CAAC,oH;;;;;;;;;;;;;;;;;;ACpHH,QAAQ,CAAC,YAAY,CAAC,iBAAiB,EAAE;AACvC,OAAK,EAAE,EAAE;AACT,WAAS,EAAE,IAAI;AACf,MAAI,EAAE,UAAU,IAAI,EAAE,GAAG,EAAE,MAAM,EAAE,GAAG,EAAE,MAAM,EAAE,QAAQ,EAAE;;AAExD,WAAO,GAAG,CAAC,KAAK,KAAK,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,QAAQ,IAAI,MAAM,KAAK,GAAG,CAAC,MAAM;GACxE;CACF,CAAC,CAAC;;AAEH,QAAQ,CAAC,YAAY,CAAC,gBAAgB,EAAE;AACtC,OAAK,EAAE,EAAE;AACT,WAAS,EAAE,IAAI;AACf,MAAI,EAAE,UAAU,IAAI,EAAE,GAAG,EAAE,MAAM,EAAE,GAAG,EAAE,MAAM,EAAE,QAAQ,EAAE;AACxD,QAAG,IAAI,KAAK,QAAQ,EAAE;AACpB,UAAI,MAAM,GAAG,QAAQ,CAAC,IAAI,CAAC,MAAM;AACjC,UAAI,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC;KACtC;;AAED,WAAO,IAAI,KAAK,SAAS,IAAK,IAAI,CAAC,MAAM,KAAK,MAAO;GACtD;CACF,CAAC,CAAC;;AAEH,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,QAAQ,CAAC,CAAC,CAC1B,eAAe,EAAE,CACjB,cAAc,EAAE,CAChB,SAAS,CAAC,CAAC,QAAQ,EAAE,aAAa,EAAE,cAAc,EAAE,cAAc,EAAE,eAAe,CAAC,CAAC,CACrF,KAAK,EAAE,C;;;;;;;;;;;;;;;;;;AC1BV,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,SAAS,EAAE;AACvB,SAAO,EAAE,YAAW;AAClB,QAAI,GAAG,GAAG;AACR,OAAC,EAAE,IAAI;AACP,gBAAU,EAAE,YAAW,EACtB;AACD,eAAS,EAAE,WAAW;AACtB,kBAAY,EAAE,IAAI,CAAC,KAAK,IAAI,eAAe;AAC3C,YAAM,EAAE;AACN,qBAAa,EAAE;AACb,aAAG,EAAE,YAAW;AACd,gBAAI,CAAC,oBAAoB,EAAE,CAAC;AAC5B,gBAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;WAC5C;SACF;OACF;KACF;;;;;AAKD,OAAG,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,GAAG;AACtC,cAAQ,EAAE,YAAW;AACnB,YAAI,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,GAAG,EAAE,EAAC,IAAI,EAAE,EAAC,KAAK,EAAE,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAC,EAAC,CAAC;OAC1E;AACD,kBAAY,EAAE,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,uBAAuB;AACtD,aAAO,EAAE,YAAW;;OAEnB;KACF;;;;;AAKD,OAAG,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,uBAAuB,CAAC,GAAG;AACrD,cAAQ,EAAE,YAAW;AACnB,YAAI,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,GAAG,EAAE,EAAC,IAAI,EAAE;AACnC,iBAAK,EAAE,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,uBAAuB;AAC/C,0BAAc,EAAE,IAAI,IAAI,EAAE;WAC3B,EAAC,CAAC;;AAEH,YAAI,aAAa,GAAG,IAAI,CAAC,eAAe;AACxC,YAAI,MAAM,GAAG,IAAI,CAAC,OAAO;;;AAGzB,YAAG,CAAC,CAAC,gBAAgB,IAAI,CAAC,CAAC,aAAa,IAAI,CAAC,CAAC,MAAM,EAAE;AACpD,cAAI,QAAQ,GAAG,IAAI,CAAC,CAAC,CAAC,QAAQ,EAAE;AAChC,cAAI,aAAa,GAAG,IAAI,CAAC,CAAC,CAAC,aAAa,EAAE;AAC1C,cAAI,WAAW,GAAG,IAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,aAAa,CAAC;AACrD,cAAI,UAAU,GAAG,IAAI,CAAC,KAAK,CAAC,aAAa,GAAG,QAAQ,CAAC;AACrD,cAAI,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,IAAI,QAAQ,GAAG,UAAU,CAAC,CAAC;;AAEtD,cAAI,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,GAAG,EAAE,EAAC,IAAI,EAAE;AACnC,mBAAK,EAAE,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,uBAAuB;AAC/C,2BAAa,EAAE,aAAa;AAC5B,yBAAW,EAAE,WAAW;AACxB,wBAAU,EAAE,UAAU;AACtB,iBAAG,EAAE,GAAG;aACT,EAAC,CAAC;SACJ;OACF;AACD,kBAAY,EAAE,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,qBAAqB;AACpD,mBAAa,EAAE,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,cAAc;AAC9C,aAAO,EAAE,YAAW,EACnB;KACF;;;;;AAKD,OAAG,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,cAAc,CAAC,GAAG;AAC5C,cAAQ,EAAE,YAAW;AACnB,YAAI,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,GAAG,EAAE,EAAC,IAAI,EAAE,EAAC,KAAK,EAAE,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,cAAc,EAAC,EAAC,CAAC;AAC/E,YAAI,MAAM,GAAG,SAAS,CAAC,MAAM,CAAC,QAAQ,CAAC,iBAAiB,CAAC,CAAC;AAC1D,YAAI,MAAM,GAAG,MAAM,CAAC,SAAS,CAAC,MAAM,CAAC,OAAO,CAAC,MAAM,EAAE,MAAM,CAAC,OAAO,CAAC,CAAC;;AAErE,YAAI,aAAa,GAAG;AAClB,gBAAM,EAAE,IAAI,CAAC,CAAC,CAAC,KAAK,EAAE;AACtB,kBAAQ,EAAE,KAAK;SAChB;;AAED,YAAG,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,MAAM,EAAE;AAClB,cAAI,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,MAAM,CAAC;AAC5C,cAAI,SAAS,GAAG,IAAI,CAAC,YAAY;AACjC,cAAI,QAAQ,GAAG,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,SAAS,CAAC,OAAO,CAAC,EAAC,MAAM,EAAE,IAAI,CAAC,CAAC,CAAC,MAAM,EAAC,CAAC;;AAElF,WAAC,CAAC,MAAM,CAAC,aAAa,EAAE;AACtB,kBAAM,EAAE,SAAS;AACjB,oBAAQ,EAAE,QAAQ,CAAC,WAAW;WAC/B,CAAC;SACH,MAAM,IAAG,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,SAAS,EAAE;AAC5B,WAAC,CAAC,MAAM,CAAC,aAAa,EAAE;AACtB,kBAAM,EAAE,IAAI,CAAC,CAAC,CAAC,SAAS;WACzB,CAAC;SACH;;AAED,YAAI;AACF,cAAI,IAAI,GAAG,MAAM,CAAC,aAAa,CAAC,CAAC;AACjC,cAAI,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,GAAG,EAAE,EAAC,IAAI,EAAE;AACnC,uBAAS,EAAE,IAAI,IAAI,EAAE;AACrB,iCAAmB,EAAE,IAAI,CAAC,EAAE;AAC5B,2BAAa,EAAE,IAAI,CAAC,MAAM;aAC3B,EAAC,CAAC;AACH,cAAI,CAAC,MAAM,CAAC,2BAA2B,CAAC;SACzC,CAAC,OAAO,KAAK,EAAE;AACd,iBAAO,CAAC,GAAG,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;AAC3B,cAAI,CAAC,MAAM,CAAC,aAAa,CAAC;SAC3B;OACF;AACD,iCAA2B,EAAE,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,2BAA2B;AACzE,mBAAa,EAAE,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,oBAAoB;AACpD,aAAO,EAAE,YAAW,EACnB;KACF;;;;;AAMD,OAAG,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,2BAA2B,CAAC,GAAG;AACzD,cAAQ,EAAE,YAAW;AACnB,YAAI,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,GAAG,EAAE,EAAC,IAAI,EAAE,EAAC,KAAK,EAAE,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,2BAA2B,EAAC,EAAC,CAAC;OAC7F;AACD,uBAAiB,EAAE,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,mBAAmB;AACvD,aAAO,EAAE,YAAW,EACnB;KACF;;;;;AAKD,OAAG,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,mBAAmB,CAAC,GAAG;AACjD,cAAQ,EAAE,YAAW;AACnB,YAAI,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,GAAG,EAAE,EAAC,IAAI,EAAE;AACnC,iBAAK,EAAE,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,mBAAmB;AAC3C,8BAAkB,EAAE,IAAI,IAAI,EAAE;WAC/B,EAAC,CAAC;AACH,YAAI,MAAM,GAAG,SAAS,CAAC,MAAM,CAAC,QAAQ,CAAC,iBAAiB,CAAC,CAAC;;AAE1D,YAAI,QAAQ,GAAG,MAAM,CAAC,SAAS,CAAC,MAAM,CAAC,SAAS,CAAC,MAAM,EAAE,MAAM,CAAC,SAAS,CAAC,CAAC;;;AAG3E,YAAI,eAAe,GAAG,kBAAkB,CAAC,IAAI,CAAC,CAAC,CAAC,GAAG,CAAC;AACpD,YAAI,cAAc,GAAG,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,eAAe,CAAC,OAAO,CAAC;AACpE,gBAAM,EAAE,eAAe,CAAC,MAAM;SAC/B,CAAC;;AAEF,YAAG,CAAC,CAAC,cAAc,EAAE;AACnB,cAAI;;AAEF,gBAAI,MAAM,GAAG,QAAQ,CAAC;AACpB,oBAAM,EAAE,IAAI,CAAC,CAAC,CAAC,WAAW;AAC1B,sBAAQ,EAAE,KAAK;AACf,yBAAW,EAAE,cAAc,CAAC,WAAW;AACvC,yBAAW,EAAE,oBAAoB,GAAG,IAAI,CAAC,CAAC,CAAC,GAAG;aAC/C,CAAC,CAAC;;;AAGH,gBAAI,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,GAAG,EAAE,EAAC,IAAI,EAAE;AACnC,6BAAa,EAAE,IAAI,IAAI,EAAE;AACzB,yCAAyB,EAAE,MAAM,CAAC,MAAM,EAAE;AAC1C,oCAAoB,EAAE,MAAM,CAAC,EAAE;AAC/B,8BAAc,EAAE,MAAM,CAAC,MAAM;AAC7B,6CAA6B,EAAE,cAAc,CAAC,GAAG;eAClD,EAAC,CAAC;;AAEH,gBAAI,CAAC,MAAM,CAAC,QAAQ,CAAC;WACtB,CAAC,OAAO,KAAK,EAAE;AACd,mBAAO,CAAC,GAAG,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;AAC3B,kBAAM,IAAI,MAAM,CAAC,KAAK,CAAC,uBAAuB,EAAE,KAAK,CAAC,OAAO,CAAC,CAAC;WAChE;SACF,MAAM;AACL,cAAI,GAAG,GAAG,gDAAgD;AAC1D,gBAAM,IAAI,MAAM,CAAC,KAAK,CAAC,iCAAiC,EAAE,GAAG,CAAC,CAAC;SAChE;OAEF;AACD,cAAQ,EAAE,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,OAAO;AAClC,oBAAc,EAAE,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,2BAA2B;AAC5D,aAAO,EAAE,YAAW;;OAEnB;KACF;;;;;AAKD,OAAG,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,GAAG;AACrC,cAAQ,EAAE,YAAW;AACnB,YAAI,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,GAAG,EAAE,EAAC,IAAI,EAAE;AACnC,iBAAK,EAAE,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,OAAO;AAC/B,qBAAS,EAAE,IAAI,IAAI,EAAE;WACtB,EAAC,CAAC;OACJ;AACD,aAAO,EAAE,YAAW;;OAEnB;KACF;;;;;AAKD,OAAG,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,qBAAqB,CAAC,GAAG;AACnD,cAAQ,EAAE,YAAW;AACnB,YAAI,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,GAAG,EAAE,EAAC,IAAI,EAAE,EAAC,KAAK,EAAE,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,qBAAqB,EAAC,EAAC,CAAC;OACvF;AACD,aAAO,EAAE,YAAW;;OAEnB;KACF;;;;;AAKD,OAAG,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,oBAAoB,CAAC,GAAG;AAClD,cAAQ,EAAE,YAAW;AACnB,YAAI,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,GAAG,EAAE,EAAC,IAAI,EAAE,EAAC,KAAK,EAAE,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,oBAAoB,EAAC,EAAC,CAAC;OACtF;AACD,aAAO,EAAE,YAAW;;OAEnB;KACF;;;;;AAKD,OAAG,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,kBAAkB,CAAC,GAAG;AAChD,cAAQ,EAAE,YAAW;AACnB,YAAI,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,GAAG,EAAE,EAAC,IAAI,EAAE,EAAC,KAAK,EAAE,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,kBAAkB,EAAC,EAAC,CAAC;OACpF;AACD,aAAO,EAAE,YAAW;;OAEnB;KACF;;AAED,WAAO,IAAI,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC;GAC5B;AACD,YAAU,EAAE,YAAW;AACrB,QAAI,CAAC,OAAO,EAAE,CAAC,MAAM,CAAC,YAAY,CAAC;GACpC;AACD,YAAU,EAAE,YAAW;AACrB,QAAI,CAAC,OAAO,EAAE,CAAC,MAAM,CAAC,YAAY,CAAC;GACpC;AACD,aAAW,EAAE,YAAW;AACtB,QAAI,CAAC,OAAO,EAAE,CAAC,MAAM,CAAC,aAAa,CAAC;GACrC;AACD,iBAAe,EAAE,YAAW;AAC1B,QAAI,CAAC,OAAO,EAAE,CAAC,MAAM,CAAC,iBAAiB,CAAC;GACzC;CACF,CAAC,qH;;;;;;;;;;;;;;;;;;ACzPF,MAAM,CAAC,OAAO,CAAC,oBAAoB,EAAE,YAAW;AAC9C,SAAO,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,EAAC,MAAM,EAAE,IAAI,CAAC,MAAM,EAAC,CAAC;CACrD,CAAC,CAAC,oH;;;;;;;;;;;;;;;;;;ACFH,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,SAAS,GAAG,IAAI,KAAK,CAAC,UAAU,CAAC,qBAAqB,CAAC,CAAC;;AAEjF,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,SAAS,CAAC,YAAY,CAAC,IAAI,YAAY,CAAC;AAC/D,QAAM,EAAE;AACN,QAAI,EAAE,MAAM;AACZ,aAAS,EAAE,YAAW;AACpB,aAAO,IAAI,CAAC,MAAM,CAAC;KACpB;GACF;AACD,aAAW,EAAE;AACX,QAAI,EAAE,MAAM;GACb;CACF,CAAC,CAAC,CAAC,mH;;;;;;;;;;;;;;;;;;ACZJ,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,eAAe,GAAG,IAAI,KAAK,CAAC,UAAU,CAAC,2BAA2B,CAAC;AAC5F,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,eAAe,CAAC,YAAY,CAAC,IAAI,YAAY,CAAC;AACrE,QAAM,EAAE;AACN,QAAI,EAAE,MAAM;AACZ,aAAS,EAAE,YAAW;AACpB,aAAO,IAAI,CAAC,MAAM,CAAC;KACpB;GACF;AACD,aAAW,EAAE;AACX,QAAI,EAAE,MAAM;GACb;AACD,iBAAe,EAAE;AACf,QAAI,EAAE,MAAM;GACb;AACD,kBAAgB,EAAE;AAChB,QAAI,EAAE,MAAM;GACb;AACD,uBAAqB,EAAE;AACrB,QAAI,EAAE,OAAO;GACd;AACD,mBAAiB,EAAE;AACjB,QAAI,EAAE,OAAO;GACd;AACD,QAAM,EAAE;AACN,QAAI,EAAE,MAAM;AACZ,YAAQ,EAAE,IAAI;GACf;AACD,UAAQ,EAAE;AACR,QAAI,EAAE,MAAM;AACZ,YAAQ,EAAE,IAAI;GACf;AACD,SAAO,EAAE;AACP,QAAI,EAAE,MAAM;AACZ,YAAQ,EAAE,IAAI;GACf;AACD,WAAS,EAAE;AACT,QAAI,EAAE,MAAM;AACZ,YAAQ,EAAE,IAAI;GACf;AACD,UAAQ,EAAE;AACR,QAAI,EAAE,MAAM;AACZ,YAAQ,EAAE,IAAI;GACf;AACD,iBAAe,EAAE;AACf,QAAI,EAAE,MAAM;AACZ,YAAQ,EAAE,IAAI;GACf;CACF,CAAC,CAAC,CAAC;;AAEJ,MAAM,CAAC,OAAO,CAAC;AACb,sBAAoB,EAAE,UAAS,OAAO,EAAE;AACtC,QAAI,MAAM,GAAG,SAAS,CAAC,IAAI,CAAC,iBAAiB,CAAC;AAC9C,QAAI,cAAc,GAAG,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,eAAe,CAAC,OAAO,CAAC,EAAC,MAAM,EAAE,MAAM,CAAC,MAAM,EAAE,EAAC,CAAC;AAChG,QAAI,aAAa,GAAG,MAAM,CAAC,SAAS,CAAC,MAAM,CAAC,QAAQ,CAAC,MAAM,EAAE,MAAM,CAAC,QAAQ,CAAC,CAAC;AAC9E,QAAI;;AAEF,UAAI,MAAM,GAAG,aAAa,CAAC,cAAc,CAAC,WAAW,EAAE,CAAC,CAAC,MAAM,CAAC,OAAO,EAAE;AACvE,sBAAc,EAAE;AACd,cAAI,EAAE,MAAM,CAAC,IAAI,EAAE,CAAC,eAAe;AACnC,YAAE,EAAE,MAAM,CAAC,IAAI,EAAE,CAAC,eAAe;SAClC;OACF,CAAC,CAAC,CAAC;;AAEJ,aAAO,MAAM,CAAC,iBAAiB;KAChC,CAAC,OAAO,KAAK,EAAE;AACd,YAAM,IAAI,MAAM,CAAC,KAAK,CAAC,qCAAqC,EAAE,KAAK,CAAC,OAAO,CAAC,CAAC;KAC9E;GACF;CACF,CAAC,CAAC,oH;;;;;;;;;;;;;;;;;;ACpEH,MAAM,CAAC,OAAO,CAAC;AACb,qBAAmB,EAAE,UAAS,OAAO,EAAE;AACrC,SAAK,CAAC,OAAO,EAAE;AACb,YAAM,EAAE,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC;AAC9B,gBAAU,EAAE,KAAK,CAAC,QAAQ,CAAC,CAAC,MAAM,CAAC,CAAC;AACpC,iBAAW,EAAE,MAAM;AACnB,kBAAY,EAAE,MAAM;AACpB,kBAAY,EAAE,MAAM;AACpB,mBAAa,EAAE,MAAM;AACrB,aAAO,EAAE,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC;KAChC,CAAC;;;AAGF,QAAI,iBAAiB;AACrB,QAAG,CAAC,CAAC,MAAM,CAAC,MAAM,EAAE,EAAE;AACpB,uBAAiB,GAAG,EAAC,MAAM,EAAE,MAAM,CAAC,MAAM,EAAE,EAAC;KAC9C,MAAM,IAAI,CAAC,CAAC,OAAO,CAAC,OAAO,EAAE;AAC5B,uBAAiB,GAAG,EAAC,OAAO,EAAE,OAAO,CAAC,OAAO,EAAC;KAC/C,MAAM;AACL,YAAM,IAAI,MAAM,CAAC,KAAK,CAAC,eAAe,EAAE,8EAA8E,CAAC,CAAC;KACzH;;;AAGD,QAAI,YAAY,GAAG,CAAC,CAAC,MAAM,CAAC,EAAE,GAAG,EAAE,OAAO,CAAC,MAAM,EAAC,EAAE,iBAAiB,CAAC;AACtE,QAAI,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,YAAY,CAAC;AAC3C,QAAG,CAAC,CAAC,IAAI,EAAE;AACT,UAAI,qBAAqB,GAAG,CAAC,CAAC,MAAM,CAAC,EAAC,KAAK,EAAE,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAC,EAAE,iBAAiB,CAAC;AAC3F,UAAI,aAAa,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,qBAAqB,CAAC;;;AAG1D,UAAG,aAAa,CAAC,KAAK,EAAE,GAAG,CAAC,EAAE;AAC5B,SAAC,CAAC,IAAI,CAAC,aAAa,CAAC,KAAK,EAAE,EAAE,UAAS,YAAY,EAAE;AACnD,cAAI,CAAC,KAAK,CAAC,MAAM,CAAC,YAAY,CAAC,GAAG,EAAE,EAAC,IAAI,EAAE,OAAO,EAAC,CAAC;AACpD,gBAAM,CAAC,IAAI,CAAC,kBAAkB,EAAE,YAAY,CAAC,GAAG,CAAC,CAAC;SACnD,CAAC;;AAEF,eAAO,IAAI;OACZ;KACF,MAAM,IAAG,CAAC,CAAC,OAAO,CAAC,UAAU,EAAE;AAC9B,UAAI,UAAU,GAAG,OAAO,CAAC,UAAU;AACnC,aAAO,OAAO,CAAC,UAAU;AACzB,UAAI,qBAAqB,GAAG,CAAC,CAAC,MAAM,CAAC,EAAC,KAAK,EAAE,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAC,EAAE,iBAAiB,CAAC;AAC3F,UAAI,aAAa,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,qBAAqB,CAAC;;;AAG1D,UAAG,aAAa,CAAC,KAAK,EAAE,GAAG,CAAC,EAAE;AAC5B,qBAAa,GAAG,aAAa,CAAC,KAAK,EAAE;AACrC,aAAI,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,aAAa,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AAC5C,cAAI,YAAY,GAAG,aAAa,CAAC,CAAC,CAAC;AACnC,cAAI,CAAC,KAAK,CAAC,MAAM,CAAC,YAAY,CAAC,GAAG,EAAE;AAClC,gBAAI,EAAE,CAAC,CAAC,MAAM,CAAC,EAAC,SAAS,EAAE,UAAU,CAAC,CAAC,CAAC,EAAC,EAAE,OAAO,CAAC;WACpD,CAAC;AACF,gBAAM,CAAC,IAAI,CAAC,kBAAkB,EAAE,YAAY,CAAC,GAAG,CAAC,CAAC;SACnD;;AAED,eAAO,IAAI;OACZ;KACF;;AAED,UAAM,IAAI,MAAM,CAAC,KAAK,CAAC,cAAc,EAAE,uEAAuE,CAAC,CAAC;GACjH;AACD,oBAAkB,EAAE,UAAS,MAAM,EAAE;AACnC,SAAK,CAAC,MAAM,EAAE,MAAM,CAAC;;AAErB,QAAG,iBAAiB,CAAC,MAAM,CAAC,EAAE;AAC5B,UAAI,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC;AACrC,UAAI,CAAC,UAAU,EAAE;AACjB,aAAO,IAAI,CAAC,GAAG;KAChB;;AAED,UAAM,IAAI,MAAM,CAAC,KAAK,CAAC,cAAc,EAAE,sCAAsC,CAAC,CAAC;GAChF;AACD,qBAAmB,EAAE,UAAS,MAAM,EAAE;AACpC,SAAK,CAAC,MAAM,EAAE,MAAM,CAAC;AACrB,QAAG,8BAA8B,CAAC,MAAM,CAAC,EAAE;AACzC,UAAI,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC;AACrC,UAAI,CAAC,WAAW,EAAE;AAClB,aAAO,IAAI,CAAC,GAAG;KAChB;;AAED,UAAM,IAAI,MAAM,CAAC,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;GAC/B;AACD,yBAAuB,EAAE,UAAS,MAAM,EAAE;AACxC,SAAK,CAAC,MAAM,EAAE,MAAM,CAAC;AACrB,QAAG,IAAI,CAAC,OAAO,EAAE,EAAE;AACjB,UAAI,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC;AACrC,UAAI,CAAC,eAAe,EAAE;AACtB,aAAO,IAAI,CAAC,GAAG;KAChB;;AAED,UAAM,IAAI,MAAM,CAAC,KAAK,CAAC,CAAC,EAAE,mCAAmC,CAAC,CAAC;GAChE;AACD,wBAAsB,EAAE,UAAS,MAAM,EAAE,EAExC;CACF,CAAC,CAAC,oH;;;;;;;;;;;;;;;;;;AC/FH,MAAM,CAAC,OAAO,CAAC,qBAAqB,EAAE,UAAS,SAAS,EAAE;AACxD,OAAK,CAAC,SAAS,EAAE,MAAM,CAAC,CAAC;;AAEzB,MAAI,OAAO,GAAG,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC;AAClC,OAAG,EAAE,SAAS;AACd,eAAW,EAAE,IAAI;AACjB,aAAS,EAAE,KAAK;GACjB,CAAC;;AAEF,MAAG,OAAO,EACR,OAAO,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,EAAC,QAAQ,EAAE,SAAS,EAAE,gBAAgB,EAAE,UAAU,EAAC,CAAC;CAC/E,CAAC,CAAC;;AAEH,MAAM,CAAC,OAAO,CAAC,wBAAwB,EAAE,UAAS,YAAY,EAAE;AAC9D,OAAK,CAAC,YAAY,EAAE,MAAM,CAAC,CAAC;;AAE5B,MAAI,UAAU,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC;AACxC,OAAG,EAAE,YAAY;AACjB,eAAW,EAAE,IAAI;AACjB,aAAS,EAAE,KAAK;GACjB,CAAC;;AAEF,MAAG,UAAU,EACX,OAAO,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,EAAC,QAAQ,EAAE,YAAY,EAAE,gBAAgB,EAAE,aAAa,EAAC,CAAC;CACrF,CAAC,CAAC,oH;;;;;;;;;;;;;;;;;;ACxBH,QAAQ,CAAC,YAAY,CAAC,YAAY,EAAE;AAClC,OAAK,EAAE,EAAE;AACT,WAAS,EAAE,IAAI;AACf,MAAI,EAAE,UAAU,IAAI,EAAE,GAAG,EAAE,MAAM,EAAE,GAAG,EAAE,MAAM,EAAE,QAAQ,EAAE;AACxD,QAAG,CAAC,CAAC,MAAM,EAAE;AACX,UAAI,UAAU,GAAG,GAAG,CAAC,gBAAgB;AACrC,UAAI,QAAQ,GAAG,GAAG,CAAC,QAAQ;AAC3B,UAAG,KAAK,CAAC,YAAY,CACnB,MAAM,EACN,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,QAAQ,CAAC,EAC5B,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,EAAE;;AAEzB,YAAG,UAAU,KAAK,aAAa,EAAE;AAC/B,cAAI,UAAU,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC;AACxC,eAAG,EAAE,QAAQ;AACb,kBAAM,EAAE,MAAM;WACf,CAAC;;AAEF,iBAAO,CAAC,UAAU;SACnB,MAAM,IAAG,UAAU,KAAK,UAAU,EAAE;AACnC,cAAI,OAAO,GAAG,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,QAAQ,CAAC;;AAE7C,cAAG,CAAC,CAAC,OAAO,EAAE;AACZ,gBAAI,UAAU,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC;AACxC,iBAAG,EAAE,OAAO,CAAC,YAAY;AACzB,oBAAM,EAAE,MAAM;aACf,CAAC;;AAEF,mBAAO,CAAC,UAAU;WACnB;SAEF;OACF;KACJ;;AAED,WAAO,IAAI;GACZ;CACF,CAAC,CAAC;;AAEH,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC,CACrC,UAAU,EAAE,CACZ,KAAK,EAAE,6D;;;;;;;;;;;;;;;;;;ACzCV,MAAM,CAAC,OAAO,CAAC;AACb,2BAAyB,EAAE,UAAS,YAAY,EAAE;;AAEhD,SAAK,CAAC,YAAY,EAAE,MAAM,CAAC;;;AAG3B,QAAI,gBAAgB,GAAG,QAAQ,CAAC,GAAG,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC,CACjD,MAAM,CAAC,YAAY,EAAE,EAAC,IAAI,EAAE,EAAC,WAAW,EAAE,IAAI,EAAC,EAAC,CAAC,OAC/C,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,KAAK,EAAE;;AAE/B,QAAI,gBAAgB,EAAE;;AAEpB,UAAI,gBAAgB,GAAG,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC;AAC3C,oBAAY,EAAE,YAAY;AAC1B,mBAAW,EAAE,IAAI;AACjB,iBAAS,EAAE,KAAK;OACjB,CAAC;;AAEF,UAAG,CAAC,CAAC,gBAAgB,EAAE;AACrB,YAAI,CAAC,WAAW,CAAC,MAAM,CAAC,YAAY,EAClC,EAAC,IAAI,EAAE,EAAC,WAAW,EAAE,IAAI,EAAC,EAAC,EAC3B,EAAC,aAAa,EAAE,KAAK,EAAC,CAAC;OAC1B,MAAM;AACL,cAAM,IAAI,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,cAAc,EAAE,qDAAqD,CAAC;OAC1G;KACF,MAAM;AACL,YAAM,IAAI,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,YAAY,EAAE,iCAAiC,CAAC;KACpF;GACF;CACF,CAAC,CAAC,oH;;;;;;;;;;;;;;;;;;AC7BH,MAAM,CAAC,OAAO,CAAC;AACb,wBAAsB,EAAE,UAAS,SAAS,EAAE;AAC1C,SAAK,CAAC,SAAS,EAAE,MAAM,CAAC;;AAExB,QAAI,OAAO,GAAG,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,SAAS,CAAC;AAC9C,QAAG,CAAC,OAAO,EACT,MAAM,IAAI,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,YAAY,EAAE,iCAAiC,CAAC;;;AAGrF,QAAI,gBAAgB,GAAG,QAAQ,CAAC,GAAG,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC,CACjD,MAAM,CAAC,OAAO,EAAE,EAAC,IAAI,EAAE,EAAC,WAAW,EAAE,IAAI,EAAC,EAAC,CAAC,OACzC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,KAAK,EAAE;;AAE7B,QAAI,gBAAgB,EAAE;;AAEpB,OAAC,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE,EAAE,UAAS,IAAI,EAAE;AAC3C,YAAI,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC;AAC9B,mBAAS,EAAE,SAAS;AACpB,cAAI,EAAE,IAAI;SACX,CAAC;;AAEF,YAAG,CAAC,KAAK,EAAE;AACT,gBAAM,IAAI,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,cAAc,EAAE,iDAAiD,CAAC;SACtG;OACF,CAAC;;AAEF,aAAO,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,SAAS,EACnC,EAAC,IAAI,EAAE,EAAC,WAAW,EAAE,IAAI,EAAC,EAAC,EAC3B,EAAC,aAAa,EAAE,KAAK,EAAC,CACvB;KACF,MAAM;AACL,YAAM,IAAI,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,YAAY,EAAE,iCAAiC,CAAC;KACpF;GACF;CACF,CAAC,CAAC,oH;;;;;;;;;;;;;;;;;;AClCH,MAAM,CAAC,OAAO,CAAC,aAAa,EAAE,UAAS,SAAS,EAAE;AAChD,SAAO,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;AACvB,OAAK,CAAC,SAAS,EAAE,MAAM,CAAC,CAAC;;AAEzB,MAAI,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,EAAC,SAAS,EAAE,SAAS,EAAC,CAAC;AACrD,MAAI,OAAO,GAAG,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,SAAS,CAAC;AAC9C,MAAG,CAAC,OAAO,EACT,OAAM;;AAER,MAAI,UAAU,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC;AACxC,OAAG,EAAE,OAAO,CAAC,YAAY;AACzB,aAAS,EAAE,KAAK;GACjB,CAAC;AACF,MAAG,CAAC,UAAU,EACZ,OAAM;;AAER,MAAG,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE;AAC7B,WAAO,MAAM;GAEd,MAAM,IAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE;AAClC,QAAG,IAAI,CAAC,MAAM,KAAK,UAAU,CAAC,KAAK,EACjC,OAAO,MAAM;GAEhB,MAAM,IAAG,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE;AACvC,QAAG,IAAI,CAAC,MAAM,KAAK,UAAU,CAAC,MAAM,EAClC,OAAO,MAAM;GAChB;;AAED,MAAI,UAAU,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC;AACxC,OAAG,EAAE,OAAO,CAAC,YAAY;AACzB,aAAS,EAAE,KAAK;AAChB,eAAW,EAAE,IAAI;GAClB,CAAC;;AAEF,MAAG,UAAU,EAAE;AACb,WAAO,MAAM;GACd;CAGF,CAAC,CAAC,oH","file":"/packages/marvin_mart.js","sourcesContent":["Mart = {\n  SERVICE_FEE_PCT: parseFloat(Meteor.settings.public.SERVICE_FEE_PCT),\n  HOUR_CONNECTION_FEE_PCT: parseFloat(Meteor.settings.public.HOUR_CONNECTION_FEE_PCT),\n  DAY_CONNECTION_FEE_PCT: parseFloat(Meteor.settings.public.DAY_CONNECTION_FEE_PCT),\n  MONTH_CONNECTION_FEE_PCT: parseFloat(Meteor.settings.public.MONTH_CONNECTION_FEE_PCT),\n  TAX_PCT: parseFloat(Meteor.settings.public.TAX_PCT),\n  STRIPE_PUBLIC_KEY: Meteor.settings.public.STRIPE_PUBLIC_KEY,\n}\n\nif(Meteor.isServer){\n  _.extend(Mart, {\n    STRIPE_SECRET_KEY: Meteor.settings.STRIPE_SECRET_KEY,\n  })\n}\n","Mart.Errors = {\n  UNAUTHORIZED: \"mart-unauthorized\",\n  CANNOT_PUBLISH: \"mart-cannot-publish\"\n}\n","_.extend(Mart, {\n  ROLES: {\n    GLOBAL: {\n      SHOPPER: 'mart-roles-golbal-shopper',\n      MERCHANT: 'mart-roles-golbal-merchant',\n      ADMIN: 'mart-roles-global-admin',\n      REP: 'mart-roles-global-rep'\n    },\n    GROUPS: {\n      GLOBAL: 'mart-roles-groups-global'\n    }\n  },\n  isAdmin: function() {\n    return this._isAdmin(Meteor.userId())\n  },\n  isRep: function() {\n    return this._isRep(Meteor.userId())\n  },\n  isMerchant: function() {\n    return this._isMerchant(Meteor.userId())\n  },\n  canActAsMerchant: function() {\n    return this.isMerchant() || this.isRep() || this.isAdmin()\n  },\n  _isAdmin: function(userId) {\n    return Roles.userIsInRole(userId,\n      [Mart.ROLES.GLOBAL.ADMIN],\n      Mart.ROLES.GROUPS.GLOBAL)\n  },\n  _isRep: function(userId) {\n    return Roles.userIsInRole(userId,\n      [Mart.ROLES.GLOBAL.REP],\n      Mart.ROLES.GROUPS.GLOBAL)\n  },\n  _isMerchant: function(userId) {\n    return Roles.userIsInRole(userId,\n      [Mart.ROLES.GLOBAL.MERCHANT],\n      Mart.ROLES.GROUPS.GLOBAL)\n  },\n  _isShopper: function(userId) {\n    return Roles.userIsInRole(userId,\n      [Mart.ROLES.GLOBAL.SHOPPER],\n      Mart.ROLES.GROUPS.GLOBAL)\n  },\n  Accounts: {\n    // traditional options, roles: [ROLE]\n    createUser: function(options, callback) {\n      if(!Meteor.userId()) {\n        Accounts.createUser(options, function(error) {\n          if(error)\n            return callback(error)\n\n          Meteor.call(\"mart/add-roles-and-terms\", options.roles, callback);\n        })\n      } else {\n        callback(new Meteor.Error('signup-error', \"You must log out before creating another account.\"))\n      }\n    },\n    SignInSchema: new SimpleSchema({\n      email: {\n        type: String,\n      },\n      password: {\n        type: String,\n      },\n      termsAccepted: {\n        type: Boolean\n      }\n    }),\n\n  }\n})\n","Security.defineMethod('ifRoles', {\n  fetch: [],\n  deny: function (type, roles, userId, doc) {\n    return !userId ||\n      !Roles.userIsInRole(userId, roles, Mart.ROLES.GROUPS.GLOBAL)\n  }\n});\n","Mart.Storefronts = new Mongo.Collection(\"MartStorefronts\",{\n  transform: function(doc) {return new Storefront(doc)}\n});\n\nvar Storefront = function(doc) {\n  _.extend(this, doc)\n}\n\n_.extend(Storefront.prototype, {\n  products: function() {\n    return Mart.Products.find({storefrontId: this._id})\n  },\n})\nMart.Storefronts.attachSchema(new SimpleSchema({\n  name: {\n    type: String,\n    label: \"Name\",\n    max: 50\n  },\n  description: {\n    type: String,\n    label: \"Description\",\n    optional: true,\n    max: 1000\n  },\n  isPublished: {\n    type: Boolean,\n    label: \"Ready to be published?\",\n    autoValue: function() {\n      // Should only be able to publish from server if several conditions are met\n      this.unset()\n      if(this.isInsert) {\n        return false\n      }\n    }\n  },\n  isDeleted: {\n    type: Boolean,\n    autoValue: function() {\n      // Should only be able to publish from server if several conditions are met\n      this.unset()\n      if(this.isInsert) {\n        return false\n      }\n    }\n  },\n  userId: {\n    type: String,\n    // Reps and Admins can create Storefronts on behalf of Merchants\n    // Don't allow reassignment for security\n    autoValue: function() {\n      if(this.isInsert) {\n        if(Roles.userIsInRole(\n          this.userId,\n          [Mart.ROLES.GLOBAL.REP, Mart.ROLES.GLOBAL.ADMIN],\n          Mart.ROLES.GROUPS.GLOBAL)) {\n            return\n        } else if(Mart._isMerchant(this.userId)) {\n          return this.userId\n        }\n      }\n      this.unset()\n    },\n    denyUpdate: true\n  },\n  repId: {\n    type: String,\n    optional: true,\n    autoValue: function() {\n      if(this.isInsert && Roles.userIsInRole(\n        this.userId,\n        [Mart.ROLES.GLOBAL.REP],\n        Mart.ROLES.GROUPS.GLOBAL)) {\n          return this.userId\n      } else if(Roles.userIsInRole(\n        this.userId,\n        [Mart.ROLES.GLOBAL.ADMIN],\n        Mart.ROLES.GROUPS.GLOBAL)) {\n          return this.value || this.userId\n      }\n\n      this.unset()\n    },\n  },\n  address: {\n    type: String\n  },\n  address2: {\n    type: String,\n    optional: true\n  },\n  city: {\n    type: String,\n  },\n  state: {\n    type: String\n  },\n  zip: {\n    type: String\n  },\n  createdAt: {\n    type: Date,\n    autoValue: function() {\n      if(this.isInsert) {\n        return new Date()\n      }\n\n      this.unset()\n    },\n  }\n}))\n","Mart.Images = new Mongo.Collection(\"MartImages\");\n\nMart.Images.attachSchema(new SimpleSchema({\n  objectId: {\n    type: String,\n    denyUpdate: true\n  },\n  objectCollection: {\n    type: String,\n    denyUpdate: true,\n    allowedValues: ['Storefronts', 'Products']\n  },\n  originalUrl: {\n    type: String,\n    denyUpdate: true\n  },\n  thumbnailUrl: {\n    type: String,\n    denyUpdate: true\n  },\n  optimizedUrl: {\n    type: String,\n    denyUpdate: true\n  },\n  index: {\n    type: Number,\n  }\n}));\n","Mart.Gateways = new Mongo.Collection(\"MartGateways\");\nMart.GatewayTypes = {}\n\nMart.Gateways.attachSchema(new SimpleSchema({\n  gatewayType: {\n    type: String,\n    allowedValues: ['Test', 'Stripe']\n  },\n  businessName: {\n    type: String,\n  },\n  businessURL: {\n    type: String,\n  },\n  detailsSubmitted: {\n    type: Boolean,\n  },\n  chargesEnabled: {\n    type: Boolean,\n  },\n  transfersEnabled: {\n    type: Boolean,\n  },\n}));\n","Mart.Cards = new Mongo.Collection(\"MartCards\");\nMart.Card = {\n  card: function(cardId) {\n    return Mart.Cards.findOne(cardId)\n  },\n  gateway: function(cardId) {\n    return Mart.Gateways.findOne(this.card(cardId).gatewayId)\n  }\n}\n\nMart.Cards.attachSchema(new SimpleSchema({\n  userId: {\n    type: String,\n    autoValue: function() {\n      return this.userId;\n    },\n    denyUpdate: true,\n    optional: true\n  },\n  guestId: {\n    type: String,\n    denyUpdate: true,\n    optional: true\n  },\n  gateway: {\n    type: String,\n    denyUpdate: true,\n    allowedValues: ['Test', 'Stripe']\n  },\n  gatewayToken: {\n    type: String,\n    denyUpdate: true,\n  },\n  last4: {\n    type: Number,\n    min: 1000,\n    max: 9999,\n    denyUpdate: true\n  },\n  expMonth: {\n    type: Number,\n    min: 0,\n    max: 12,\n    denyUpdate: true\n  },\n  expYear: {\n    type: Number,\n    min: new Date().getFullYear(),\n    max: new Date().getFullYear() + 100,\n    denyUpdate: true\n  },\n  nameOnCard: {\n    type: String,\n    denyUpdate: true,\n    max: 100\n  },\n  brand: {\n    type: String,\n    denyUpdate: true,\n    allowedValues: ['Visa', 'Mastercard']\n  },\n}));\n","Mart.GatewayTypes.Stripe = {\n  getSecretKey: function(options) {\n    return options.secretKey || Mart.STRIPE_SECRET_KEY\n  },\n  getPublicKey: function(options) {\n    return options.publicKey || Mart.STRIPE_PUBLIC_KEY.StripePublicKey\n  },\n}\n","Mart.GatewayTypes.Test = {\n  retrieveAccountInfo: function(options) {\n    accountAttrs = {\n      gatewayType: \"Test\",\n      businessName: \"Test Gateway Business Name\",\n      businessURL: \"example.com\",\n      detailsSubmitted: false,\n      chargesEnabled: false,\n      transfersEnabled: false\n    }\n\n    Mart.Gateways.upsert({}, {$set: accountAttrs})\n    return Mart.Gateways.findOne()._id\n  },\n}\n","Mart.Products = new Mongo.Collection(\"MartProducts\");\n\nMart.Products.attachSchema(new SimpleSchema({\n  storefrontId: {\n    type: String\n  },\n  name: {\n    type: String,\n    label: \"Name\",\n    max: 50\n  },\n  description: {\n    type: String,\n    label: \"Description\",\n    optional: true,\n    max: 1000\n  },\n  isPublished: {\n    type: Boolean,\n    label: \"Ready to be published?\",\n    autoValue: function() {\n      // Should only be able to publish from server if several conditions are met\n      this.unset()\n      if(this.isInsert) {\n        return false\n      }\n    }\n  },\n  isDeleted: {\n    type: Boolean,\n    autoValue: function() {\n      // Should only be able to publish from server if several conditions are met\n      this.unset()\n      if(this.isInsert) {\n        return false\n      }\n    }\n  },\n  createdAt: {\n    type: Date,\n    autoValue: function() {\n      if(this.isInsert) {\n        return new Date()\n      }\n\n      this.unset()\n    },\n  },\n  occupancy: {\n    type: Number,\n    optional: true\n  },\n  size: {\n    type: String,\n    optional: true\n  }\n}));\n\nMart.Product = {\n  UNITS: {\n    HOUR: \"hour\",\n    DAY: \"day\",\n    MONTH: \"month\"\n  },\n  _UNITS: function() {\n    return _.keys(_.invert(this.UNITS))\n  }\n}\n","Mart.Prices = new Mongo.Collection(\"MartPrices\");\n\nMart.Prices.attachSchema(new SimpleSchema({\n  productId: {\n    type: String\n  },\n  unit: {\n    type: String,\n    allowedValues: Mart.Product._UNITS()\n  },\n  priceInCents: {\n    type: Number\n  }\n}))\n","Mart.LineItems = new Mongo.Collection(\"MartLineItems\", {\n  transform: function (doc) { return new LineItem(doc); }\n});\n\nvar LineItem = function(doc) {\n  _.extend(this, doc)\n}\n\n_.extend(LineItem.prototype, {\n  subtotal: function() {\n    return this.quantity * this.unitPriceAtCheckout\n  },\n  connectionFee: function() {\n    var connectionFeePct\n    if(this._.unit === Mart.Product.UNITS.HOUR) {\n      connectionFeePct = Mart.HOUR_CONNECTION_FEE_PCT\n    } else if(this._.unit === Mart.Product.UNITS.DAY) {\n      connectionFeePct = Mart.DAY_CONNECTION_FEE_PCT\n    } else if(this._.unit === Mart.Product.UNITS.MONTH) {\n      connectionFeePct = Mart.MONTH_CONNECTION_FEE_PCT\n    } else {\n      throw new Meteor.error('invalid-unit', \"Invalid unit selected\")\n    }\n    return this.subtotal() * connectionFeePct\n  }\n})\n\nMart.LineItems.after.remove(function(userId, doc) {\n  var cart = Mart.Carts.findOne({_id: doc.cartId, state: Mart.Cart.STATES.SHOPPING})\n  if(cart && cart.lineItems().length === 0)\n    Mart.Carts.remove(cart._id)\n})\n\nMart.LineItem = {\n  lineItem: function(lineItemId) {\n    return Mart.LineItems.findOne(lineItemId)\n  },\n  remove: function(lineItemId) {\n    return Mart.LineItems.remove(lineItemId)\n  }\n}\n\nMart.LineItems.attachSchema(new SimpleSchema({\n  cartId: {\n    type: String,\n    denyUpdate: true,\n    autoValue: function() {\n      if(Meteor.isServer) {\n        var productId = this.field(\"productId\").value\n        var product = Mart.Products.findOne(productId)\n        var storefront = Mart.Storefronts.findOne(product.storefrontId)\n        // If user logged in, find or create cart for this shopper and\n        // the merchant the product belongs to\n        if(!!this.userId) {\n          var cart = Mart.Carts.findOne({\n            storefrontId: storefront._id,\n            state: Mart.Cart.STATES.SHOPPING,\n            userId: this.userId\n          })\n\n          if(cart)\n            return cart._id\n\n          var cartId = Mart.Carts.insert({\n            storefrontId: storefront._id,\n            merchantId: storefront.userId,\n            state: Mart.Cart.STATES.SHOPPING,\n            userId: this.userId\n          })\n\n          return cartId\n        } else {\n          var guestId = this.field(\"guestId\").value\n          // Find or create cart for guest\n          if(!!guestId) {\n            var cart = Mart.Carts.upsert({\n              storefrontId: storefrontId,\n              state: Mart.Cart.STATES.SHOPPING,\n              guestId: guestId\n            }, {$set: {\n              storefrontId: storefront._id,\n              merchantId: storefront.userId,\n              state: Mart.Cart.STATES.SHOPPING,\n              guestId: guestId\n            }})\n            return cart.insertedId\n          } else {\n            // No user or guest to associate to\n            return undefined\n          }\n        }\n      }\n    }\n  },\n  guestId: {\n    type: String,\n    optional: true\n  },\n  productId: {\n    type: String,\n    denyUpdate: true\n  },\n  unit: {\n    type: String,\n    allowedValues: Mart.Product._UNITS()\n  },\n  quantity: {\n    type: Number\n  },\n  startAtDate: {\n    type: Date\n  },\n  startAtHour: {\n    type: Number\n  },\n  startAtMinute: {\n    type: Number\n  },\n  productNameAtCheckout: {\n    type: String,\n    autoValue: function() {\n\n      if(this.isInsert) {\n        if(Meteor.isServer){\n          var productId = this.field(\"productId\").value\n          var product = Mart.Products.findOne(productId)\n          return product.name;\n        }\n        return \"Loading...\"\n      }\n\n      this.unset()\n    },\n    denyUpdate: true\n  },\n  storefrontIdAtCheckout: {\n    type: String,\n    autoValue: function() {\n      if(this.isInsert) {\n        if(Meteor.isServer) { // In case not subscribed to product on client side\n          var productId = this.field(\"productId\").value\n          return storefrontVal(productId, \"_id\")\n        }\n        return \"Loading...\"\n      }\n      this.unset()\n    },\n  },\n  storefrontNameAtCheckout: {\n    type: String,\n    autoValue: function() {\n      if(this.isInsert) {\n        if(Meteor.isServer) { // In case not subscribed to product on client side\n          var productId = this.field(\"productId\").value\n          return storefrontVal(productId, \"name\")\n        }\n        return \"Loading...\"\n      }\n      this.unset()\n    },\n  },\n  addressAtCheckout: {\n    type: String,\n    autoValue: function() {\n      if(this.isInsert) {\n        if(Meteor.isServer) { // In case not subscribed to product on client side\n          var productId = this.field(\"productId\").value\n          return storefrontVal(productId, \"address\")\n        }\n        return \"Loading...\"\n      }\n      this.unset()\n    },\n  },\n  address2AtCheckout: {\n    type: String,\n    autoValue: function() {\n      if(this.isInsert) {\n        if(Meteor.isServer) { // In case not subscribed to product on client side\n          var productId = this.field(\"productId\").value\n          return storefrontVal(productId, \"address2\")\n        }\n      }\n      this.unset()\n    },\n    optional: true\n  },\n  cityAtCheckout: {\n    type: String,\n    autoValue: function() {\n      if(this.isInsert) {\n        if(Meteor.isServer) { // In case not subscribed to product on client side\n          var productId = this.field(\"productId\").value\n          return storefrontVal(productId, \"city\")\n        }\n        return \"Loading...\"\n      }\n      this.unset()\n    },\n  },\n  stateAtCheckout: {\n    type: String,\n    autoValue: function() {\n      if(this.isInsert) {\n        if(Meteor.isServer) { // In case not subscribed to product on client side\n          var productId = this.field(\"productId\").value\n          return storefrontVal(productId, \"state\")\n        }\n        return \"Loading...\"\n      }\n      this.unset()\n    },\n  },\n  zipAtCheckout: {\n    type: String,\n    autoValue: function() {\n      if(this.isInsert) {\n        if(Meteor.isServer) { // In case not subscribed to product on client side\n          var productId = this.field(\"productId\").value\n          return storefrontVal(productId, \"zip\")\n        }\n        return \"Loading...\"\n      }\n      this.unset()\n    },\n  },\n  unitPriceAtCheckout: {\n    type: Number,\n    autoValue: function() {\n      if(this.isInsert) {\n        if(Meteor.isServer) { // In case not subscribed to product on client side\n          var productId = this.field(\"productId\").value\n          var unit = this.field(\"unit\").value\n\n          var price = Mart.Prices.findOne({productId: productId, unit: unit})\n\n          return price.priceInCents;\n        }\n        return 0\n      }\n      this.unset()\n    },\n    // denyUpdate: true\n  },\n  createdAt: {\n    type: Date,\n    autoValue: function() {\n      if(this.isInsert) {\n        return new Date()\n      }\n      this.unset()\n    },\n    denyUpdate: true\n  }\n}));\n\nvar storefrontVal = function(productId, attrName) {\n  var product = Mart.Products.findOne(productId)\n\n  if(product) {\n    storefront = Mart.Storefronts.findOne(product.storefrontId)\n    return storefront[attrName];\n  }\n}\n","Mart.BankAccounts = new Mongo.Collection(\"MartBankAccounts\");\n\n// only admins + merchants can see accoutns - publications\n// needs a method to add account with a\n// allow update of name and isDefault - secutiry\n\nMart.BankAccounts.attachSchema(new SimpleSchema({\n  userId: {\n    type: String,\n    denyUpdate: true,\n    autoValue: function() {\n      return Meteor.userId()\n    }\n  },\n  name: {\n    type: String\n  },\n  bankName: {\n    type: String,\n    denyUpdate: true\n  },\n  last4: {\n    type: String,\n    denyUpdate: true\n  },\n  routingNumber: {\n    type: String,\n    denyUpdate: true\n  },\n  isDefault: {\n    type: Boolean,\n  },\n  gateway: {\n    type: String\n  },\n  gatewayToken: {\n    type: String\n  },\n  country: {\n    type: String\n  },\n  currency: {\n    type: String\n  }\n}))\n","Mart.Carts = new Mongo.Collection(\"MartCarts\", {\n  transform: function (doc) { return new Cart(doc); }\n});\n\nCart = function(doc) {\n  _.extend(this, doc)\n}\n\n_.extend(Cart.prototype, {\n  subtotal: function() {\n    var lines = Mart.LineItems.find({cartId: this._id}).fetch()\n    return _.reduce(lines, function(sum, line) {\n      return sum + line.subtotal()\n    }, 0)\n  },\n  connectionFee: function() {\n    var lines = Mart.LineItems.find({cartId: this._id}).fetch()\n    return Math.floor(_.reduce(lines, function(sum, line) {\n      return sum + line.connectionFee()\n    }, 0))\n  },\n  serviceFee: function() {\n    return this.subtotal() * Mart.SERVICE_FEE_PCT\n  },\n  preTaxTotal: function() {\n    return this.subtotal() + this.serviceFee()\n  },\n  total: function() {\n    return this.preTaxTotal() + this.tax()\n  },\n  lineItems: function() {\n    return Mart.LineItems.find({cartId: this._id}).fetch()\n  },\n  tax: function() {\n    return this.preTaxTotal() * Mart.TAX_PCT\n  }\n})\n\ncanOpCartWaitingCartAcceptance = function(cartId) {\n  var firstStorefront = getFirstStorefront(cartId)\n  return Mart.isAdmin() ||                                                // is admin\n    (Mart.isMerchant() && firstStorefront.userId === Meteor.userId()) ||  // storefront belongs to merchant\n    (Mart.isRep() && firstStorefront.repId === Meteor.userId())           // belongs to rep\n}\n\ncanOpCartShopping = function(cartId) {\n  var cart = Mart.Carts.findOne(cartId)\n  return (!!cart.userId && cart.userId === Meteor.userId()) ||  // cart belongs to user\n    (cart.guestId && !cart.userId)                              // cart doesn't belong to anybody\n}\n\ngetFirstStorefront = function(cartId) {\n  var firstLineItem = Mart.LineItems.findOne({cartId: cartId})\n  var firstProduct = Mart.Products.findOne(firstLineItem.productId)\n  return Mart.Storefronts.findOne(firstProduct.storefrontId)\n}\n\nMart.Cart = {\n  GUEST_ID: 'mart-cart-guest-id',\n  SESSION_ID: 'mart-cart-session-id',\n  STATES: {\n    SHOPPING: \"mart-cart-state-shopping\",\n    WAITING_CART_ACCEPTANCE: \"mart-cart-state-waiting-cart-acceptance\",\n    MAKING_PAYMENT: 'mart-cart-state-making-payment',\n    WAITING_TRANSFER_ACCEPTANCE: 'mart-cart-state-waiting-transfer-acceptance',\n    PROCESSING_TRANSFER: 'mart-cart-state-processing-transfer',\n    SETTLED: 'mart-cart-state-settled',\n    CANCELLED_BY_MERCHANT: 'mart-cart-state-cancelled-by-merchant',\n    CANCELLED_BY_PAYMENT: 'mart-cart-state-cancelled-by-payment',\n    CANCELLED_BY_ADMIN: 'mart-cart-state-cancelled-by-admin',\n  },\n}\n\nMart.Carts.attachSchema(new SimpleSchema({\n  state: {\n    type: String,\n  },\n  merchantId: {\n    type: String,\n  },\n  storefrontId: {\n    type: String\n  },\n  userId: {\n    type: String,\n    optional: true\n  },\n  guestId: {\n    type: String,\n    optional: true\n  },\n  cardId: {\n    type: String,\n    optional: true\n  },\n  cardToken: {\n    type: String,\n    optional: true\n  },\n  contactRentingOnBehalfBiz: {\n    type: Boolean,\n    optional: true,\n  },\n  contactFirstName: {\n    type: String,\n    optional: true,\n  },\n  contactLastName: {\n    type: String,\n    optional: true,\n  },\n  contactEmail: {\n    type: String,\n    optional: true,\n  },\n  contactPhone: {\n    type: String,\n    optional: true,\n  },\n  contactBusiness: {\n    type: String,\n    optional: true,\n  },\n  contactAddress: {\n    type: String,\n    optional: true,\n  },\n  contactAddress2: {\n    type: String,\n    optional: true,\n  },\n  contactCity: {\n    type: String,\n    optional: true,\n  },\n  contactZIP: {\n    type: String,\n    optional: true,\n  },\n  serviceFee: {\n    type: Number,\n    optional: true\n  },\n  connectionFee: {\n    type: Number,\n    optional: true\n  },\n  merchantCut: {\n    type: Number,\n    optional: true\n  },\n  tax: {\n    type: Number,\n    optional: true\n  },\n  paymentAt: {\n    type: Date,\n    optional: true\n  },\n  paymentConfirmation: {\n    type: String,\n    optional: true\n  },\n  paymentAmount: {\n    type: Number,\n    optional: true\n  },\n  cartAcceptedAt: {\n    type: Date,\n    optional: true\n  },\n  submittedAt: {\n    type: Date,\n    optional: true\n  },\n  transferredAt: {\n    type: Date,\n    optional: true\n  },\n  transferredToBankAccountId: {\n    type: String,\n    optional: true\n  },\n  transferredToManagedAccountId: {\n    type: String,\n    optional: true\n  },\n  transferAcceptedAt: {\n    type: Date,\n    optional: true\n  },\n  transferConfirmation: {\n    type: String,\n    optional: true\n  },\n  transferAmount: {\n    type: Number,\n    optional: true\n  },\n  settledAt: {\n    type: Date,\n    optional: true\n  },\n  transferAcceptedByAdminId: {\n    type: String,\n    optional: true\n  }\n}));\n","Meteor.publish(\"mart/storefronts\", function() {\n  // console.log(\"mart/storefronts\");\n  if(Mart._isAdmin(this.userId)) {\n      // Admins can view everything\n      return [\n        Mart.Storefronts.find(),\n        Mart.Images.find({objectCollection: \"Storefronts\"})\n      ]\n  } else if(Mart._isMerchant(this.userId)) {\n      // Merchants can view everything they created that hasn't been deleted\n      return [\n        Mart.Storefronts.find({userId: this.userId, isDeleted: false}),\n        Mart.Images.find({objectCollection: \"Storefronts\"})\n      ]\n  } else if(Mart._isRep(this.userId)) {\n      // Merchants can view everything they created that hasn't been deleted\n      return [\n        Mart.Storefronts.find({repId: this.userId, isDeleted: false}),\n        Mart.Images.find({objectCollection: \"Storefronts\"})\n      ]\n  } else {\n    // No role or user required to view published stores stores\n    return [\n      Mart.Storefronts.find(\n        {isPublished: true, isDeleted: false},\n        {fields: {\n          _id: 1,\n          name: 1,\n          description: 1,\n          address: 1,\n          address2: 1,\n          city: 1,\n          state: 1,\n          zip: 1,\n          userId: 1,\n        }}),\n      Mart.Images.find()\n    ]\n  }\n\n});\n\nMeteor.publish(\"mart/storefront\", function(storefrontId) {\n  check(storefrontId, String)\n  var storefront = Mart.Storefronts.findOne(storefrontId)\n\n  if(!storefront)\n    return\n\n  if(Mart._isAdmin(this.userId)) {\n      // Admins can view everything\n      return [\n        Mart.Storefronts.find({_id: storefrontId}),\n        Mart.Products.find({storefrontId: storefrontId}),\n        Mart.Images.find({objectId: storefrontId, objectCollection: \"Storefronts\"}),\n        Meteor.users.find(storefront.userId, {fields: {\n          profile: 1,\n        }})\n      ]\n  } else if(Mart._isMerchant(this.userId)) {\n      // Merchants can view everything they created that hasn't been deleted\n      return [\n        Mart.Storefronts.find({userId: this.userId, isDeleted: false, _id: storefrontId}),\n        Mart.Products.find({storefrontId: storefrontId}),\n        Mart.Images.find({objectId: storefrontId, objectCollection: \"Storefronts\"}),\n        Meteor.users.find(storefront.userId, {fields: {\n          profile: 1,\n        }})\n      ]\n  } else if(Mart._isRep(this.userId)) {\n      // Merchants can view everything they created that hasn't been deleted\n      return [\n        Mart.Storefronts.find({repId: this.userId, isDeleted: false, _id: storefrontId}),\n        Mart.Products.find({storefrontId: storefrontId}),\n        Mart.Images.find({objectId: storefrontId, objectCollection: \"Storefronts\"}),\n        Meteor.users.find(storefront.userId, {fields: {\n          profile: 1,\n        }})\n      ]\n  } else {\n    return [\n      Mart.Storefronts.find(\n        {isPublished: true, isDeleted: false, _id: storefrontId},\n        {fields: {\n          _id: 1,\n          name: 1,\n          description: 1,\n          address: 1,\n          address2: 1,\n          city: 1,\n          state: 1,\n          zip: 1,\n          userId: 1,\n        }}),\n      Mart.Products.find({\n          isPublished: true,\n          isDeleted: false,\n          storefrontId: storefrontId\n        },\n        {fields: {\n          _id: 1,\n          name: 1,\n          description: 1,\n          storefrontId: 1,\n          occupancy: 1,\n          size: 1,\n        }}),\n      Mart.Images.find({objectId: storefrontId, objectCollection: \"Storefronts\"}),\n      Meteor.users.find(storefront.userId, {fields: {\n        profile: 1,\n      }})\n    ]\n  }\n});\n","Mart.Storefronts.permit(['insert', 'update'])\n.ifRoles([\n  Mart.ROLES.GLOBAL.MERCHANT,\n  Mart.ROLES.GLOBAL.ADMIN,\n  Mart.ROLES.GLOBAL.REP\n])\n.apply()\n","// Cannot already be logged in if creating a new user\nAccounts.validateNewUser(function (user) {\n  if(this.userId) {\n    throw new Meteor.Error(403, \"Not authorized to create new users\");\n  } else {\n    return true\n  }\n});\n\n// Only Shoppers and Merchants can be created\nvar areRolesValid = function(roles) {\n  let allowedRolesWithoutLogin = [\n    Mart.ROLES.GLOBAL.SHOPPER,\n    Mart.ROLES.GLOBAL.MERCHANT\n  ]\n\n  let sanitizedRoles = _.intersection(roles, allowedRolesWithoutLogin)\n  return sanitizedRoles.length === roles.length\n}\nvar clientIP = function() {\n  // var env = process.env.NODE_ENV;\n  var env = false\n\n  if (env === 'production') {\n    return this.connection.clientAddress;\n  } else {\n    return '127.0.0.1'\n  }\n}\n\nMeteor.methods({\n  'mart/add-roles-and-terms': function(roles) {\n    check(roles, Match.OneOf([String], undefined, null))\n    roles = roles || [Mart.ROLES.GLOBAL.SHOPPER]\n\n    if(areRolesValid(roles)) {\n      _.each(roles, function(role) {\n        Roles.addUsersToRoles(Meteor.userId(), roles, Mart.ROLES.GROUPS.GLOBAL);\n      })\n      Meteor.users.update(Meteor.userId(), {$set: {\n        termsAcceptedIP: clientIP(),\n        termsAcceptedAt: Math.floor(Date.now() / 1000)\n      }})\n\n      Accounts.sendVerificationEmail(Meteor.userId())\n    } else {\n      throw new Meteor.Error(403, \"You do not have permission to assume that role.\");\n    }\n  }\n});\n\nMeteor.publish(\"mart/user-terms-data\", function () {\n  if (this.userId) {\n    return Meteor.users.find(\n      {_id: this.userId},\n      {fields: {'termsAcceptedAt': 1, 'termsAcceptedIP': 1}});\n  } else {\n    this.ready();\n  }\n});\n","Meteor.publish(\"mart/user\", function(userId) {\n  check(userId, String);\n\n  if(userId === this.userId) {\n    return Meteor.users.find(userId, {fields: {\n      emails: 1,\n      profile: 1,\n      roles: 1\n    }})\n  }\n});\n\nMeteor.publish(\"mart/profile\", function(userId){\n  check(userId, String);\n  return Meteor.users.find(userId, {fields: {\n    profile: 1,\n  }})\n});\n","Meteor.publish(\"mart/cards\", function(guestId) {\n  check(guestId, Match.OneOf(String, null, undefined))\n\n  var selector\n  if(this.userId) {\n    selector = {userId: this.userId}\n  } else {\n    selector = {guestId: guestId}\n  }\n\n  return Mart.Cards.find(selector, {fields: {\n    _id: 1,\n    last4: 1,\n    expMonth: 1,\n    expYear: 1,\n    nameOnCard: 1,\n    brand: 1\n  }})\n});\n","Meteor.publish(\"mart/products\", function(storefrontId) {\n  return Mart.Products.find({\n    isActive: true,\n    isDeleted: false,\n    storefrontId: storefrontId\n  },\n  {fields: {\n    _id: 1,\n    name: 1,\n    description: 1,\n    occupancy: 1,\n    size: 1,\n  }});\n});\n\nMeteor.publish(\"mart/product\", function(productId) {\n  check(productId, String)\n\n  var product = Mart.Products.findOne(productId)\n\n  return [\n    Mart.Products.find({\n      isPublished: true,\n      isDeleted: false,\n      _id: productId\n      },\n      {fields: {\n        _id: 1,\n        name: 1,\n        description: 1,\n        occupancy: 1,\n        size: 1,\n      }}),\n\n    Mart.Storefronts.find({\n        isPublished: true,\n        isDeleted: false,\n        _id: product.storefrontId\n      },\n      {fields: {\n        _id: 1,\n        name: 1,\n        description: 1,\n        address: 1,\n        address2: 1,\n        city: 1,\n        state: 1,\n        zip: 1\n      }}),\n\n    Mart.Images.find({\n      objectId: productId,\n      objectCollection: \"Products\",\n    }),\n\n    Mart.Prices.find({\n      productId: productId\n    })\n  ]\n});\n","Security.defineMethod(\"ifStorefrontBelongsToCurrentUser\", {\n  fetch: [],\n  transform: null,\n  deny: function (type, arg, userId, doc) {\n    var storefront = Mart.Storefronts.findOne({\n      _id: doc.storefrontId,\n      isDeleted: false\n    })\n\n    if(!!storefront)\n      return userId !== storefront.userId\n\n    return true;\n  }\n});\n\nSecurity.defineMethod(\"ifStorefrontManagedByCurrentUser\", {\n  fetch: [],\n  transform: null,\n  deny: function (type, arg, userId, doc) {\n    var storefront = Mart.Storefronts.findOne({\n      _id: doc.storefrontId,\n      isDeleted: false\n    })\n\n    if(!!storefront)\n      return userId !== storefront.repId\n\n    return true;\n  }\n});\n\nMart.Products.permit(['insert', 'update'])\n  .ifRoles([\n    Mart.ROLES.GLOBAL.MERCHANT,\n  ])\n  .ifStorefrontBelongsToCurrentUser()\n  .apply();\n\nMart.Products.permit(['insert', 'update'])\n  .ifRoles([\n    Mart.ROLES.GLOBAL.ADMIN,\n    Mart.ROLES.GLOBAL.REP\n  ])\n  .ifStorefrontManagedByCurrentUser()\n  .apply();\n","Security.defineMethod(\"ifProductBelongsToCurrentUser\", {\n  fetch: [],\n  transform: null,\n  deny: function (type, arg, userId, doc) {\n    var product = Mart.Products.findOne({\n      _id: doc.productId,\n      isDeleted: false\n    })\n\n    if(!!product) {\n      var storefront = Mart.Storefronts.findOne({\n        _id: product.storefrontId,\n        isDeleted: false\n      })\n\n      if(!!storefront)\n        return userId !== storefront.userId\n    }\n    return true;\n  }\n});\n\nSecurity.defineMethod(\"ifProductManagedByCurrentUser\", {\n  fetch: [],\n  transform: null,\n  deny: function (type, arg, userId, doc) {\n    var product = Mart.Products.findOne({\n      _id: doc.productId,\n      isDeleted: false\n    })\n\n    if(!!product) {\n      var storefront = Mart.Storefronts.findOne({\n        _id: product.storefrontId,\n        isDeleted: false\n      })\n\n      if(!!storefront)\n        return userId !== storefront.repId\n    }\n\n    return true;\n  }\n});\n\nSecurity.defineMethod(\"ifOnlyUnitPrice\", {\n  fetch: [],\n  transform: null,\n  deny: function (type, arg, userId, doc) {\n    var price = Mart.Prices.findOne({\n      unit: doc.unit,\n      productId: doc.productId\n    })\n\n    return !!price\n  }\n});\n\n\nMart.Prices.permit(['insert'])\n  .ifRoles([\n    Mart.ROLES.GLOBAL.MERCHANT,\n  ])\n  .ifProductBelongsToCurrentUser()\n  .ifOnlyUnitPrice()\n  .apply();\n\nMart.Prices.permit(['insert'])\n  .ifRoles([\n    Mart.ROLES.GLOBAL.ADMIN,\n    Mart.ROLES.GLOBAL.REP\n  ])\n  .ifProductManagedByCurrentUser()\n  .ifOnlyUnitPrice()\n  .apply();\n\nMart.Prices.permit(['update'])\n  .ifRoles([\n    Mart.ROLES.GLOBAL.MERCHANT,\n  ])\n  .ifProductBelongsToCurrentUser()\n  .apply();\n\nMart.Prices.permit(['update'])\n  .ifRoles([\n    Mart.ROLES.GLOBAL.ADMIN,\n    Mart.ROLES.GLOBAL.REP\n  ])\n  .ifProductManagedByCurrentUser()\n  .apply();\n","Meteor.publish(\"mart/gateways\", function() {\n  return Mart.Gateways.find({})\n});\n\nMeteor.methods({\n  'mart/update-gateway-info': function (gatewayTypeName) {\n    check(gatewayTypeName, String)\n\n    return Mart.GatewayTypes[gatewayTypeName].retrieveAccountInfo();\n  },\n  // 'mart/charge-card': function (gatewayTypeName, cardId, cartId, options) {\n  //   check(gatewayTypeName, String)\n  //   return gatewayType.chargeCard(cardId, cartId, options);\n  // },\n});\n","\n_.extend(Mart.GatewayTypes.Stripe, {\n  // Get account info, create a gateway if none exists\n  // return gateway._id\n  retrieveAccountInfo: function() {\n    var retrieveAccount = Meteor.wrapAsync(Stripe.accounts.retrieve, Stripe.accounts);\n    try {\n      var result = retrieveAccount();\n\n      accountAttrs = {\n        gatewayType: \"Stripe\",\n        businessName: result.business_name,\n        businessURL: result.business_url,\n        detailsSubmitted: result.details_submitted,\n        chargesEnabled: result.charges_enabled,\n        transfersEnabled: result.transfers_enabled\n      }\n\n      Mart.Gateways.upsert({}, {$set: accountAttrs})\n      return Mart.Gateways.findOne()._id\n    } catch (error) {\n      throw new Meteor.Error(\"stripe-charge-error\", error.message);\n    }\n  },\n  createCard: function(stripeToken, card) {\n    console.log('server#createCard');\n    var customerToken = this.getCustomerToken()\n    console.log(customerToken);\n    var Stripe = StripeAPI(Mart.STRIPE_SECRET_KEY)\n    console.log('Stripe');\n    console.log(Stripe);\n    console.log(Stripe.customers);\n    var createSource = Meteor.wrapAsync(Stripe.customers.createSource, Stripe.customers);\n    console.log('createSource');\n    console.log(createSource);\n    console.log('final');\n    console.log(stripeToken);\n    console.log(customerToken);\n    try {\n      // Add Card to Stripe\n      var result = createSource(customerToken, {source: stripeToken});\n      console.log(card);\n      card[\"gatewayToken\"] = result.id\n      console.log('result');\n      console.log(result);\n      // Add Card to Collection\n      var cardId = Mart.Cards.insert(card)\n      return cardId\n    } catch (error) {\n      console.log(error);\n      throw new Meteor.Error(\"stripe-customer-source-error\", error.message);\n    }\n  },\n  getCustomerToken: function() {\n    console.log('getCustomerToken');\n    var Stripe = StripeAPI(Mart.STRIPE_SECRET_KEY)\n    var existingCustomer = this.Customers.findOne({userId: Meteor.userId()}),\n        customerToken\n\n    // Stripe cards must be added to a customer, see if one exists\n    if(existingCustomer) {\n      customerToken = existingCustomer.stripeToken\n    } else {\n      // Customer for this user does noes exist, create one\n      var createCustomer = Meteor.wrapAsync(Stripe.customers.create, Stripe.customers);\n\n      try {\n        // Create on Stripe\n        var result = createCustomer({description: \"Customer for user \" + Meteor.userId()});\n        customerToken = result.id\n\n        // Create in Collection\n        var t = this.Customers.insert({stripeToken: customerToken, userId: Meteor.userId()})\n      } catch (error) {\n        throw new Meteor.Error(\"stripe-customer-create-error\", error.message);\n      }\n    }\n    return customerToken\n  }\n})\n\nMeteor.methods({\n  'mart/stripe/create-card': function(stripeToken, card) {\n    check(stripeToken, String)\n    check(card, {\n      last4: String,\n      expMonth: Number,\n      expYear: Number,\n      nameOnCard: String,\n      brand: String,\n      gateway: String\n    })\n\n    cardId = Mart.GatewayTypes.Stripe.createCard(stripeToken, card);\n    return cardId\n  },\n  'mart/stripe/create-bank-account': function(bankAccountToken, bankAccount) {\n    check(bankAccountToken, String)\n    check(bankAccount, {\n      name: String,\n      last4: String,\n      bankName: String,\n      routingNumber: String,\n      country: String,\n      currency: String,\n      recipientType: String\n    })\n\n    // Find the current user's managed account\n    var managedAccount  = Mart.GatewayTypes.Stripe.ManagedAccounts.findOne({userId: Meteor.userId()}),\n        Stripe          = StripeAPI(Mart.STRIPE_SECRET_KEY)\n\n    // Create a new managed account on stripe if one doesn't exist\n    if(!managedAccount) {\n      var acctId = createManagedAccount()\n      managedAccount = Mart.GatewayTypes.Stripe.ManagedAccounts.findOne({\n        userId: Meteor.userId(),\n        _id: acctId\n      })\n    }\n\n    // Create a bank account corresponding belonging to the managed account we just created\n    return createBankAccount(bankAccountToken, bankAccount, managedAccount)\n  }\n});\n\nvar createBankAccount = function(bankAccountToken, bankAccount, managedAccount) {\n  var Stripe = StripeAPI(Mart.STRIPE_SECRET_KEY)\n  var createBankAccount = Meteor.wrapAsync(Stripe.accounts.createExternalAccount, Stripe.accounts);\n\n  try {\n    var result = createBankAccount(managedAccount.stripeToken,\n      {external_account: bankAccountToken})\n\n    return Mart.BankAccounts.insert(_.extend(bankAccount, {\n      gateway: \"Stripe\",\n      isDefault: result.default_for_currency,\n      gatewayToken: result.id\n    }))\n\n  } catch (error) {\n    throw new Meteor.Error(\"stripe-external-account-create-error\", error.message);\n  }\n}\n\n// returns returns managed accountId\nvar createManagedAccount = function() {\n  var Stripe = StripeAPI(Mart.STRIPE_SECRET_KEY)\n  var createAccount = Meteor.wrapAsync(Stripe.accounts.create, Stripe.accounts);\n  try {\n    // Create on Stripe\n    var result = createAccount({\n      country: 'US',\n      managed: true,\n      email: Meteor.user().emails[0].address\n    });\n\n    // Create in Collection\n    return Mart.GatewayTypes.Stripe.ManagedAccounts.insert({\n      stripeToken: result.id,\n      stripePublicKey: result.keys.publishable,\n      stripePrivateKey: result.keys.secret,\n      isLegalEntityVerified: isLegalEntityVerified(result.legal_entity.verification),\n      isAccountVerified: result.transfers_enabled\n    })\n  } catch (error) {\n    throw new Meteor.Error(\"stripe-managed-account-create-error\", error.message);\n  }\n}\n\nvar isLegalEntityVerified = function(stripeDesc) {\n  return (stripeDesc === \"verified\") ? true : false\n}\n","Security.defineMethod(\"ifCartBelongsToCurrentUser\", {\n  fetch: [],\n  transform: null,\n  deny: function (type, arg, userId, doc) {\n    var cart = Mart.Carts.findOne({_id: doc.cartId, state: Mart.Cart.STATES.SHOPPING})\n    if(cart) {\n      if(!!userId) {\n        return userId !== cart.userId\n      } else {\n        // TODO prevent not logged in users from adding to somebody else's cart\n        return cart.guestId === undefined\n      }\n    }\n    return true;\n  }\n});\n\nMart.LineItems.permit(['insert', 'update', 'remove'])\n  .ifCartBelongsToCurrentUser()\n  .apply();\n","Meteor.publish('mart/cart', function(cartId) {\n  check(cartId, String);\n  if(this.userId) {\n    return Mart.Carts.find({_id: cartId})\n  }\n  this.ready();\n})\n\nMeteor.publish('mart/carts', function(states, guestId) {\n  check(states, [String]);\n  check(guestId, Match.OneOf(String, null, undefined))\n\n  var sub = this, productHandles = [], lineItemHandles = [], storefrontHandles = [],\n      cartHandle = null, lineItemHandle = null;\n\n  // send over all line items for a specific cart\n  function publishCartLineItems(cartId) {\n    var lineItemsCursor = Mart.LineItems.find({cartId: cartId})\n\n    lineItemHandles[cartId] =\n      Mongo.Collection._publishCursor(lineItemsCursor, sub, 'MartLineItems');\n\n    lineItemHandle = Mart.LineItems.find({cartId: cartId}).observeChanges({\n      added: function(id, lineItem) {\n        publishLineItemProductsAndStorefronts(lineItem);\n        sub.added('MartLineItems', id, lineItem)\n      },\n      changed: function(id, fields) {\n        sub.changed('MartLineItems', id, fields)\n      },\n      removed: function(id) {\n        productHandles[id] && productHandles[id].stop();\n        storefrontHandles[id] && storefrontHandles[id].stop();\n\n        sub.removed('MartLineItems', id);\n      }\n    });\n  }\n\n  function publishLineItemProductsAndStorefronts(lineItem) {\n    // var lineItem = Mart.LineItems.findOne(lineItemId)\n    var lineItemId = lineItem._id\n\n    var productsCursor = Mart.Products.find({_id: lineItem.productId})\n    productHandles[lineItemId] =\n      Mongo.Collection._publishCursor(productsCursor, sub, \"MartProducts\")\n\n    var product = Mart.Products.findOne(lineItem.productId)\n    var storefrontsCursor = Mart.Storefronts.find({_id: product.storefrontId})\n      storefrontHandles[lineItemId] =\n        Mongo.Collection._publishCursor(storefrontsCursor, sub, \"MartStorefronts\")\n  }\n\n  var cartsCursor\n  if(Mart._isAdmin(this.userId)) {\n\n      cartsCursor = Mart.Carts.find()\n\n  } else if(Mart._isRep(this.userId)) {\n\n      var reppedStorefronts = Mart.Storefronts.find({\n        repId: this.userId\n      }).fetch()\n\n      var reppedStorefrontIds = _.map(reppedStorefronts, function(storefront) {\n        return storefront._id\n      })\n\n      cartsCursor = Mart.Carts.find({storefrontId: {$in: reppedStorefrontIds}})\n\n  } else if(Mart._isShopper(this.userId)) {\n      cartsCursor = Mart.Carts.find({\n        $and: [\n          {userId: this.userId},\n          {state: {$in: states}}\n        ]\n      })\n  }\n  else if(Mart._isMerchant(this.userId)) {\n\n      cartsCursor = Mart.Carts.find({merchantId: this.userId})\n\n  } else { // guest\n    cartsCursor = Mart.Carts.find({\n      $and: [\n        {guestId: guestId},\n        {state: {$in: states}}\n      ]\n    })\n  }\n\n  cartHandle = cartsCursor.observeChanges({\n    added: function(id, cart) {\n      publishCartLineItems(id);\n      sub.added('MartCarts', id, cart);\n    },\n    changed: function(id, fields) {\n      sub.changed('MartCarts', id, fields);\n    },\n    removed: function(id) {\n      // stop observing changes on the cart's line items\n      lineItemHandles[id] && lineItemHandles[id].stop();\n      // delete the cart\n      sub.removed('MartCarts', id);\n    }\n  });\n\n  sub.ready();\n\n  // make sure we clean everything up (note `_publishCursor`\n  //   does this for us with the comment observers)\n  sub.onStop(function() {\n    cartHandle.stop();\n    if(lineItemHandle)\n      lineItemHandle.stop();\n  });\n});\n","Security.defineMethod(\"inShoppingState\", {\n  fetch: [],\n  transform: null,\n  deny: function (type, arg, userId, doc, fields, modifier) {\n    // console.log(\"inShoppingState \" + doc.state + \"  \" + userId + \"   \" + doc.userId)\n    return doc.state !== Mart.Cart.STATES.SHOPPING || userId !== doc.userId\n  }\n});\n\nSecurity.defineMethod(\"ownsCreditCard\", {\n  fetch: [],\n  transform: null,\n  deny: function (type, arg, userId, doc, fields, modifier) {\n    if(type === \"update\") {\n      var cardId = modifier.$set.cardId\n      var card = Mart.Cards.findOne(cardId)\n    }\n\n    return card === undefined || (card.userId !== userId)\n  }\n});\n\nMart.Carts.permit(['update'])\n  .inShoppingState()\n  .ownsCreditCard()\n  .onlyProps(['cardId', 'contactName', 'contactEmail', 'contactPhone', 'contactEntity'])\n  .apply()\n","_.extend(Cart.prototype, {\n  machina: function() {\n    var fsm = {\n      _: this,\n      initialize: function() {\n      },\n      namespace: \"mart-cart\",\n      initialState: this.state || \"uninitialized\",\n      states: {\n        uninitialized: {\n          \"*\": function() {\n            this.deferUntilTransition();\n            this.transition(Mart.Cart.STATES.SHOPPING);\n          }\n        },\n      }\n    }\n\n    ///////////////////\n    // SHOPPING\n    ///////////////////\n    fsm.states[Mart.Cart.STATES.SHOPPING] = {\n      _onEnter: function() {\n        Mart.Carts.update(this._._id, {$set: {state: Mart.Cart.STATES.SHOPPING}})\n      },\n      \"submitCart\": Mart.Cart.STATES.WAITING_CART_ACCEPTANCE,\n      _onExit: function() {\n        // create new cart?\n      }\n    }\n\n    ///////////////////\n    // WAITING CART ACCEPTANCE\n    ///////////////////\n    fsm.states[Mart.Cart.STATES.WAITING_CART_ACCEPTANCE] = {\n      _onEnter: function() {\n        Mart.Carts.update(this._._id, {$set: {\n          state: Mart.Cart.STATES.WAITING_CART_ACCEPTANCE,\n          cartAcceptedAt: new Date()\n        }})\n\n        var serviceFeePct = Mart.SERVICE_FEE_PCT\n        var taxPct = Mart.TAX_PCT\n\n        // Whenever object is accessed, this will be called w/ no arguments\n        if(!!connectionFeePct && !!serviceFeePct && !!taxPct) {\n          var subtotal = this._.subtotal()\n          var connectionFee = this._.connectionFee()\n          var merchantCut = Math.ceil(subtotal - connectionFee)\n          var serviceFee = Math.floor(serviceFeePct * subtotal)\n          var tax = Math.floor(taxPct * (subtotal + serviceFee))\n\n          Mart.Carts.update(this._._id, {$set: {\n            state: Mart.Cart.STATES.WAITING_CART_ACCEPTANCE,\n            connectionFee: connectionFee,\n            merchantCut: merchantCut,\n            serviceFee: serviceFee,\n            tax: tax\n          }})\n        }\n      },\n      \"rejectCart\": Mart.Cart.STATES.CANCELLED_BY_MERCHANT,\n      \"makePayment\": Mart.Cart.STATES.MAKING_PAYMENT,\n      _onExit: function() {\n      }\n    }\n\n    ///////////////////\n    // MAKING PAYMENT\n    ///////////////////\n    fsm.states[Mart.Cart.STATES.MAKING_PAYMENT] = {\n      _onEnter: function() {\n        Mart.Carts.update(this._._id, {$set: {state: Mart.Cart.STATES.MAKING_PAYMENT}})\n        var Stripe = StripeAPI(Meteor.settings.STRIPE_SECRET_KEY);\n        var charge = Meteor.wrapAsync(Stripe.charges.create, Stripe.charges);\n\n        var chargeDetails = {\n          amount: this._.total(),\n          currency: 'usd'\n        }\n\n        if(!!this._.cardId) {\n          var card = Mart.Cards.findOne(this._.cardId)\n          var cardToken = card.gatewayToken\n          var customer = Mart.GatewayTypes.Stripe.Customers.findOne({userId: this._.userId})\n\n          _.extend(chargeDetails, {\n            source: cardToken,\n            customer: customer.stripeToken\n          })\n        } else if(!!this._.cardToken) {\n          _.extend(chargeDetails, {\n            source: this._.cardToken\n          })\n        }\n\n        try {\n          var resp = charge(chargeDetails);\n          Mart.Carts.update(this._._id, {$set: {\n            paymentAt: new Date(),\n            paymentConfirmation: resp.id,\n            paymentAmount: resp.amount\n          }})\n          this.handle('requestTransferAcceptance')\n        } catch (error) {\n          console.log(error.message);\n          this.handle('failPayment')\n        }\n      },\n      \"requestTransferAcceptance\": Mart.Cart.STATES.WAITING_TRANSFER_ACCEPTANCE,\n      \"failPayment\": Mart.Cart.STATES.CANCELLED_BY_PAYMENT,\n      _onExit: function() {\n      }\n    }\n\n\n    ///////////////////\n    // WAITING TRANSFER ACCEPTANCE\n    ///////////////////\n    fsm.states[Mart.Cart.STATES.WAITING_TRANSFER_ACCEPTANCE] = {\n      _onEnter: function() {\n        Mart.Carts.update(this._._id, {$set: {state: Mart.Cart.STATES.WAITING_TRANSFER_ACCEPTANCE}})\n      },\n      \"processTransfer\": Mart.Cart.STATES.PROCESSING_TRANSFER,\n      _onExit: function() {\n      }\n    }\n\n    ///////////////////\n    // PROCESSING TRANSFER\n    ///////////////////\n    fsm.states[Mart.Cart.STATES.PROCESSING_TRANSFER] = {\n      _onEnter: function() {\n        Mart.Carts.update(this._._id, {$set: {\n          state: Mart.Cart.STATES.PROCESSING_TRANSFER,\n          transferAcceptedAt: new Date(),\n        }})\n        var Stripe = StripeAPI(Meteor.settings.STRIPE_SECRET_KEY);\n\n        var transfer = Meteor.wrapAsync(Stripe.transfers.create, Stripe.transfers);\n\n        // Currently assuming that all items in cart belong to the same merchant\n        var firstStorefront = getFirstStorefront(this._._id)\n        var managedAccount = Mart.GatewayTypes.Stripe.ManagedAccounts.findOne({\n          userId: firstStorefront.userId\n        })\n\n        if(!!managedAccount) {\n          try {\n            // Make the transfer\n            var result = transfer({\n              amount: this._.merchantCut,\n              currency: \"usd\",\n              destination: managedAccount.stripeToken,\n              description: \"Transfer for cart \" + this._._id\n            });\n\n            // Update the cart\n            Mart.Carts.update(this._._id, {$set: {\n              transferredAt: new Date(),\n              transferAcceptedByAdminId: Meteor.userId(),\n              transferConfirmation: result.id,\n              transferAmount: result.amount,\n              transferredToManagedAccountId: managedAccount._id\n            }})\n\n            this.handle('settle')\n          } catch (error) {\n            console.log(error.message);\n            throw new Meteor.Error(\"stripe-transfer-error\", error.message);\n          }\n        } else {\n          var msg = \"Could not find a managed account for this cart\"\n          throw new Meteor.Error(\"carts-state-processing-transfer\", msg);\n        }\n\n      },\n      \"settle\": Mart.Cart.STATES.SETTLED,\n      \"failTransfer\": Mart.Cart.STATES.WAITING_TRANSFER_ACCEPTANCE,\n      _onExit: function() {\n        //\n      }\n    }\n\n    ///////////////////\n    // SETTLED\n    ///////////////////\n    fsm.states[Mart.Cart.STATES.SETTLED] = {\n      _onEnter: function() {\n        Mart.Carts.update(this._._id, {$set: {\n          state: Mart.Cart.STATES.SETTLED,\n          settledAt: new Date()\n        }})\n      },\n      _onExit: function() {\n        //\n      }\n    }\n\n    ///////////////////\n    // Cancelled BY MERCHANT\n    ///////////////////\n    fsm.states[Mart.Cart.STATES.CANCELLED_BY_MERCHANT] = {\n      _onEnter: function() {\n        Mart.Carts.update(this._._id, {$set: {state: Mart.Cart.STATES.CANCELLED_BY_MERCHANT}})\n      },\n      _onExit: function() {\n        //\n      }\n    }\n\n    ///////////////////\n    // Cancelled BY PAYMENT\n    ///////////////////\n    fsm.states[Mart.Cart.STATES.CANCELLED_BY_PAYMENT] = {\n      _onEnter: function() {\n        Mart.Carts.update(this._._id, {$set: {state: Mart.Cart.STATES.CANCELLED_BY_PAYMENT}})\n      },\n      _onExit: function() {\n        //\n      }\n    }\n\n    ///////////////////\n    // Cancelled BY ADMIN\n    ///////////////////\n    fsm.states[Mart.Cart.STATES.CANCELLED_BY_ADMIN] = {\n      _onEnter: function() {\n        Mart.Carts.update(this._._id, {$set: {state: Mart.Cart.STATES.CANCELLED_BY_ADMIN}})\n      },\n      _onExit: function() {\n        //\n      }\n    }\n\n    return new machina.Fsm(fsm)\n  },\n  submitCart: function() {\n    this.machina().handle('submitCart')\n  },\n  rejectCart: function() {\n    this.machina().handle('rejectCart')\n  },\n  makePayment: function() {\n    this.machina().handle('makePayment')\n  },\n  processTransfer: function() {\n    this.machina().handle('processTransfer')\n  }\n})\n","Meteor.publish(\"mart/bank-accounts\", function() {\n  return Mart.BankAccounts.find({userId: this.userId})\n});\n","Mart.GatewayTypes.Stripe.Customers = new Mongo.Collection(\"MartStripeCustomers\");\n\nMart.GatewayTypes.Stripe.Customers.attachSchema(new SimpleSchema({\n  userId: {\n    type: String,\n    autoValue: function() {\n      return this.userId;\n    }\n  },\n  stripeToken: {\n    type: String,\n  },\n}));\n","Mart.GatewayTypes.Stripe.ManagedAccounts = new Mongo.Collection(\"MartStripeManagedAccounts\")\nMart.GatewayTypes.Stripe.ManagedAccounts.attachSchema(new SimpleSchema({\n  userId: {\n    type: String,\n    autoValue: function() {\n      return this.userId;\n    }\n  },\n  stripeToken: {\n    type: String\n  },\n  stripePublicKey: {\n    type: String\n  },\n  stripePrivateKey: {\n    type: String\n  },\n  isLegalEntityVerified: {\n    type: Boolean\n  },\n  isAccountVerified: {\n    type: Boolean\n  },\n  dobDay: {\n    type: Number,\n    optional: true\n  },\n  dobMonth: {\n    type: Number,\n    optional: true\n  },\n  dobYear: {\n    type: Number,\n    optional: true\n  },\n  firstName: {\n    type: String,\n    optional: true\n  },\n  lastName: {\n    type: String,\n    optional: true\n  },\n  legalEntityType: {\n    type: String,\n    optional: true\n  }\n}));\n\nMeteor.methods({\n  \"mart/stripe/verify\": function(details) {\n    var Stripe = StripeAPI(Mart.STRIPE_SECRET_KEY)\n    var managedAccount = Mart.GatewayTypes.Stripe.ManagedAccounts.findOne({userId: Meteor.userId()})\n    var updateAccount = Meteor.wrapAsync(Stripe.accounts.update, Stripe.accounts);\n    try {\n      // Create on Stripe\n      var result = updateAccount(managedAccount.stripeToken, _.extend(details, {\n        tos_acceptance: {\n          date: Meteor.user().termsAcceptedAt,\n          ip: Meteor.user().termsAcceptedIP,\n        }\n      }));\n\n      return result.transfers_enabled\n    } catch (error) {\n      throw new Meteor.Error(\"stripe-managed-account-create-error\", error.message);\n    }\n  },\n});\n","Meteor.methods({\n  'mart/submit-carts': function(options) {\n    check(options, {\n      cardId: Match.Optional(String),\n      cardTokens: Match.Optional([String]),\n      contactName: String,\n      contactEmail: String,\n      contactPhone: String,\n      contactEntity: String,\n      guestId: Match.Optional(String)\n    })\n\n    // Get selector for user or guest\n    var userGuestSelector\n    if(!!Meteor.userId()) {\n      userGuestSelector = {userId: Meteor.userId()}\n    } else if (!!options.guestId) {\n      userGuestSelector = {guestId: options.guestId}\n    } else {\n      throw new Meteor.Error('invalid-guest', \"User not logged in and did not provide a guest ID while trying to check out.\");\n    }\n\n    // Ensure card belongs to the person trying to checkout\n    var cardSelector = _.extend({ _id: options.cardId}, userGuestSelector)\n    var card = Mart.Cards.findOne(cardSelector)\n    if(!!card) {\n      var shoppingCartsSelector = _.extend({state: Mart.Cart.STATES.SHOPPING}, userGuestSelector)\n      var shoppingCarts = Mart.Carts.find(shoppingCartsSelector)\n\n      // Submit each cart individually to respective Merchants\n      if(shoppingCarts.count() > 0) {\n        _.each(shoppingCarts.fetch(), function(shoppingCart) {\n          Mart.Carts.update(shoppingCart._id, {$set: options})\n          Meteor.call(\"mart/submit-cart\", shoppingCart._id);\n        })\n\n        return true\n      }\n    } else if(!!options.cardTokens) {\n      var cardTokens = options.cardTokens\n      delete options.cardTokens\n      var shoppingCartsSelector = _.extend({state: Mart.Cart.STATES.SHOPPING}, userGuestSelector)\n      var shoppingCarts = Mart.Carts.find(shoppingCartsSelector)\n\n      // Submit each cart individually to respective Merchants with a different card token\n      if(shoppingCarts.count() > 0) {\n        shoppingCarts = shoppingCarts.fetch()\n        for(let i = 0; i < shoppingCarts.length; i++) {\n          let shoppingCart = shoppingCarts[i]\n          Mart.Carts.update(shoppingCart._id, {\n            $set: _.extend({cardToken: cardTokens[i]}, options)\n          })\n          Meteor.call(\"mart/submit-cart\", shoppingCart._id);\n        }\n\n        return true\n      }\n    }\n\n    throw new Meteor.Error('invalid-card', \"Trying to checkout with a card that does not belong to user or guest.\");\n  },\n  'mart/submit-cart': function(cartId) {\n    check(cartId, String)\n\n    if(canOpCartShopping(cartId)) {\n      var cart = Mart.Carts.findOne(cartId)\n      cart.submitCart()\n      return cart._id\n    }\n\n    throw new Meteor.Error('invalid-cart', \"Don't fuck with other people's carts\");\n  },\n  'mart/make-payment': function(cartId) {\n    check(cartId, String)\n    if(canOpCartWaitingCartAcceptance(cartId)) {\n      var cart = Mart.Carts.findOne(cartId)\n      cart.makePayment()\n      return cart._id\n    }\n\n    throw new Meteor.Error(1, \"\");\n  },\n  'mart/process-transfer': function(cartId) {\n    check(cartId, String)\n    if(Mart.isAdmin()) {\n      var cart = Mart.Carts.findOne(cartId)\n      cart.processTransfer()\n      return cart._id\n    }\n\n    throw new Meteor.Error(1, \"Only admins can process transfers\");\n  },\n  'mart/reject-transfer': function(cartId) {\n    \n  }\n});\n","Meteor.publish(\"mart/images/product\", function(productId) {\n  check(productId, String);\n\n  var product = Mart.Products.findOne({\n    _id: productId,\n    isPublished: true,\n    isDeleted: false\n  })\n\n  if(product)\n    return Mart.Images.find({objectId: productId, objectCollection: \"Products\"})\n});\n\nMeteor.publish(\"mart/images/storefront\", function(storefrontId) {\n  check(storefrontId, String);\n\n  var storefront = Mart.Storefronts.findOne({\n    _id: storefrontId,\n    isPublished: true,\n    isDeleted: false\n  })\n\n  if(storefront)\n    return Mart.Images.find({objectId: storefrontId, objectCollection: \"Storefronts\"})\n});\n","Security.defineMethod(\"ownsObject\", {\n  fetch: [],\n  transform: null,\n  deny: function (type, arg, userId, doc, fields, modifier) {\n    if(!!userId) {\n      var collection = doc.objectCollection\n      var objectId = doc.objectId\n      if(Roles.userIsInRole(\n        userId,\n        [Mart.ROLES.GLOBAL.MERCHANT],\n        Mart.ROLES.GROUPS.GLOBAL)) {\n\n          if(collection === \"Storefronts\") {\n            var storefront = Mart.Storefronts.findOne({\n              _id: objectId,\n              userId: userId\n            })\n\n            return !storefront\n          } else if(collection === \"Products\") {\n            var product = Mart.Products.findOne(objectId)\n\n            if(!!product) {\n              var storefront = Mart.Storefronts.findOne({\n                _id: product.storefrontId,\n                userId: userId\n              })\n\n              return !storefront\n            }\n\n          }\n        }\n    }\n\n    return true\n  }\n});\n\nMart.Images.permit(['insert', 'update'])\n  .ownsObject()\n  .apply()\n","Meteor.methods({\n  'mart/storefront/publish': function(storefrontId) {\n    // console.log('mart/storefront/publish');\n    check(storefrontId, String)\n\n    // make sure user has edit permission\n    var operationAllowed = Security.can(Meteor.userId())\n      .update(storefrontId, {$set: {isPublished: true}}).\n      for(Mart.Storefronts).check()\n\n    if (operationAllowed) {\n      // if store has at least one published product\n      let publishedProduct = Mart.Products.findOne({\n        storefrontId: storefrontId,\n        isPublished: true,\n        isDeleted: false\n      })\n\n      if(!!publishedProduct) {\n        Mart.Storefronts.update(storefrontId,\n          {$set: {isPublished: true}},\n          {getAutoValues: false})\n      } else {\n        throw new Meteor.Error(Mart.Errors.CANNOT_PUBLISH, \"There must be at least one published product first.\")\n      }\n    } else {\n      throw new Meteor.Error(Mart.Errors.UNAUTHORIZED, \"You are not allowed to do that.\")\n    }\n  }\n});\n","Meteor.methods({\n  'mart/product/publish': function(productId) {\n    check(productId, String)\n\n    var product = Mart.Products.findOne(productId)\n    if(!product)\n      throw new Meteor.Error(Mart.Errors.UNAUTHORIZED, \"You are not allowed to do that.\")\n\n    // make sure user has edit permission\n    var operationAllowed = Security.can(Meteor.userId())\n      .update(product, {$set: {isPublished: true}})\n      .for(Mart.Products).check()\n\n    if (operationAllowed) {\n      // all prices set\n      _.each(Mart.Product._UNITS(), function(unit) {\n        let price = Mart.Prices.findOne({\n          productId: productId,\n          unit: unit\n        })\n\n        if(!price) {\n          throw new Meteor.Error(Mart.Errors.CANNOT_PUBLISH, \"You must give this product prices in all units.\")\n        }\n      })\n\n      return Mart.Products.update(productId,\n        {$set: {isPublished: true}},\n        {getAutoValues: false}\n      )\n    } else {\n      throw new Meteor.Error(Mart.Errors.UNAUTHORIZED, \"You are not allowed to do that.\")\n    }\n  }\n});\n","Meteor.publish(\"mart/prices\", function(productId) {\n  console.log(productId);\n  check(productId, String);\n\n  var cursor = Mart.Prices.find({productId: productId})\n  var product = Mart.Products.findOne(productId)\n  if(!product)\n    return\n\n  var storefront = Mart.Storefronts.findOne({\n    _id: product.storefrontId,\n    isDeleted: false\n  })\n  if(!storefront)\n    return\n\n  if(Mart._isAdmin(this.userId)) {\n    return cursor\n\n  } else if(Mart._isRep(this.userId)) {\n    if(this.userId === storefront.repId)\n      return cursor\n\n  } else if(Mart._isMerchant(this.userId)) {\n    if(this.userId === storefront.userId)\n      return cursor\n  }\n\n  var storefront = Mart.Storefronts.findOne({\n    _id: product.storefrontId,\n    isDeleted: false,\n    isPublished: true\n  })\n\n  if(storefront) {\n    return cursor\n  }\n\n\n});\n"]}
{"version":3,"sources":["meteor://ðŸ’»app/packages/meteorhacks_collection-utils/packages/meteorhacks_collection-utils.js"],"names":[],"mappings":";;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yF","file":"/packages/meteorhacks_collection-utils.js","sourcesContent":["(function () {\n\n////////////////////////////////////////////////////////////////////////////////\n//                                                                            //\n// packages/meteorhacks:collection-utils/index.js                             //\n//                                                                            //\n////////////////////////////////////////////////////////////////////////////////\n                                                                              //\nvar Future = Npm.require('fibers/future');                                    // 1\n                                                                              // 2\nvar originalOpen = MongoInternals.RemoteCollectionDriver.prototype.open;      // 3\nMongoInternals.RemoteCollectionDriver.prototype.open = function(name) {       // 4\n  var self = this;                                                            // 5\n  var ret = originalOpen.call(this, name);                                    // 6\n  ret._getDb = wrapWithDb(this.mongo);                                        // 7\n                                                                              // 8\n  return ret;                                                                 // 9\n};                                                                            // 10\n                                                                              // 11\nMongo.Collection.prototype._getDb = function() {                              // 12\n  if(typeof this._collection._getDb == 'function') {                          // 13\n    return this._collection._getDb();                                         // 14\n  } else {                                                                    // 15\n    // if we can't find `_getDb()`, that means this is                        // 16\n    // a collection created before initializing this collection               // 17\n    // if so, use the default mongo connection                                // 18\n    //    eg:- Meteor.users                                                   // 19\n    var mongoConn = MongoInternals.defaultRemoteCollectionDriver().mongo;     // 20\n    return wrapWithDb(mongoConn);                                             // 21\n  }                                                                           // 22\n};                                                                            // 23\n                                                                              // 24\nMongo.Collection.prototype._getCollection = function() {                      // 25\n  var db = this._getDb();                                                     // 26\n  return db.collection(this._name);                                           // 27\n}                                                                             // 28\n                                                                              // 29\nfunction wrapWithDb(mongoConn) {                                              // 30\n  // With Meteor 1.0.4, db creation is synchronous and wait in the connection // 31\n  // constructor. So, we can get it like this.                                // 32\n  if(mongoConn.db) {                                                          // 33\n    return mongoConn.db;                                                      // 34\n  }                                                                           // 35\n                                                                              // 36\n  // This is for Meteor versions older than 1.0.4                             // 37\n  var f = new Future();                                                       // 38\n  mongoConn._withDb(function(db) {                                            // 39\n    f.return(db);                                                             // 40\n  });                                                                         // 41\n  return f.wait();                                                            // 42\n}                                                                             // 43\n////////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n"]}